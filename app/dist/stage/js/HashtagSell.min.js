/*! HashtagSell 31-05-2015 */
var htsApp=angular.module("htsApp",["globalVars","ui.router","ct.ui.router.extras.core","ct.ui.router.extras.dsr","ui.bootstrap","mentio","ui.bootstrap-slider","frapontillo.bootstrap-switch","ngTable","uiGmapgoogle-maps","ivh.treeview","vs-repeat","ui.bootstrap.datetimepicker","ngSanitize","ui-notification","ezfb","slick","braintree-angular","ui.select"]);htsApp.config(["$httpProvider","$stateProvider","$urlRouterProvider","$tooltipProvider","ivhTreeviewOptionsProvider","$locationProvider","ezfbProvider","ENV",function(a,b,c,d,e,f,g,h){a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",f.html5Mode({enabled:!0,requireBase:!1}),f.hashPrefix("!"),g.setLocale("en_US"),g.setInitParams({appId:h.fbAppId,version:"v2.1"});var i=d.$get[d.$get.length-1];d.$get=["$window","$compile","$timeout","$document","$position","$interpolate",function(a,b,c,d,e,f){return"ontouchstart"in a?function(){return{compile:function(){}}}:i(a,b,c,d,e,f)}],d.setTriggers({show:"hide"});var j=["$q","Session","$state","$timeout","redirect","authModalFactory",function(a,b,c,d,e,f){var g=a.defer();return console.log("checking login!",b.userObj),console.log("login Checker should redirect to",e),b.userObj.user_settings.loggedIn?g.resolve():(f.betaCheckModal(c.params),g.resolve()),g.promise}],k=["socketio","Session","$stateParams","splashFactory",function(a,b,c,d){if(b.userObj.user_settings.loggedIn&&(a.joinPostingRoom(c.id,"toggleSplash"),d.result&&"HSHTG"===d.result.external.source)){var e=d.result.username;a.joinUserRoom(e,b.userObj.user_settings.name)}}],l=["socketio","Session","$stateParams","splashFactory",function(a,b,c,d){if(b.userObj.user_settings.loggedIn&&(a.leavePostingRoom(c.id,"toggleSplash"),d.result&&"HSHTG"===d.result.external.source)){var e=d.result.username;a.leaveUserRoom(e)}}];c.otherwise(function(a,b){var c=a.get("$state");return c.go("404"),b.path()}),b.state("404",{views:{root:{templateUrl:"js/404/partials/404.html"}}}).state("betaAgreement",{url:"/beta-agreement",views:{root:{templateUrl:"js/legal/betaAgreement/partials/betaAgreement.partial.html",controller:"betaAgreementController"}}}).state("betaChecker",{url:"/welcome",params:{redirect:null},controller:function(a,b){a.betaCheckModal(b.params)}}).state("checkemail",{url:"/checkemail",params:{redirect:null},controller:function(a,b){a.checkEmailModal(b.params)}}).state("externalSplash",{url:"/ext/:id",controller:"splashController"}).state("feed",{url:"/feed",templateUrl:"js/feed/partials/feed.partial.html",controller:"feed.controller",resolve:{loginRequired:j,redirect:function(){return"feed"}}}).state("feed.splash",{url:"/:id",controller:"splashController",onEnter:k,onExit:l}).state("forgot",{url:"/forgot?msg",params:{redirect:null,msg:null},controller:function(a,b){a.forgotPasswordModal(b.params)}}).state("myposts",{url:"/myposts",templateUrl:"js/myPosts/partials/myPosts.html",controller:"myPosts.controller",resolve:{loginRequired:j,redirect:function(){return"myposts"}}}).state("myposts.questions",{url:"/questions/:postingId"}).state("myposts.meetings",{url:"/meetings/:postingId"}).state("myposts.splash",{url:"/:id",controller:"splashController"}).state("notifications",{url:"/notifications",templateUrl:"js/notifications/partials/notifications.html",controller:"notifications.controller",resolve:{loginRequired:j,redirect:function(){return"notifications"}}}).state("payment",{url:"/payment/:postingId/:offerId",views:{root:{controller:"paymentController",templateUrl:"js/payment/partials/payment.partial.html"}}}).state("postingRules",{url:"/posting-rules",views:{root:{templateUrl:"js/legal/postingRules/partials/postingRules.partial.html",controller:"postingRulesController"}}}).state("privacyPolicy",{url:"/privacy-policy",views:{root:{templateUrl:"js/legal/privacyPolicy/partials/privacyPolicy.partial.html",controller:"privacyPolicyController"}}}).state("profile",{url:"/profile",templateUrl:"js/profile/partials/profile.partial.html",controller:"profile.controller",resolve:{loginRequired:j,redirect:function(){return"profile"}}}).state("reset",{url:"/reset/:token/",controller:function(a,b){a.resetPasswordModal("signin",b.params.token)}}).state("results",{url:"/q/:q",params:{q:null,city:null,locationObj:null},controller:"results.controller",templateUrl:"js/results/partials/results_partial.html",resolve:{loginRequired:j,redirect:function(){return"results"}}}).state("results.splash",{url:"/:id",params:{q:null,city:null,locationObj:null,id:null},controller:"splashController",onEnter:k,onExit:l}).state("review",{url:"/review/:postingId/:offerId/:userId",views:{root:{controller:"peerReviewController",templateUrl:"js/peerReview/partials/peerReview.partial.html"}}}).state("root",{url:"/",onEnter:function(a){a.go("feed")}}).state("settings",{url:"/settings",templateUrl:"js/settings/settings_partial.html",resolve:{loginRequired:j,redirect:function(){return"settings"}}}).state("settings.account",{url:"/account",templateUrl:"js/settings/account/partials/settings.account_partial.html",controller:"settings.account.controller"}).state("settings.password",{url:"/password",templateUrl:"js/settings/password/partials/settings.password_partial.html",controller:"settings.password.controller"}).state("settings.profile",{url:"/profile",templateUrl:"js/settings/profile/partials/settings.profile_partial.html",controller:"settings.profile.controller"}).state("settings.payment",{url:"/payment",templateUrl:"js/settings/payment/partials/settings.payment_partial.html",controller:"settings.payment.controller"}).state("signin",{url:"/signin?email&tour",params:{redirect:null,email:null,tour:null},controller:function(a,b){console.log(b.params),a.signInModal(b.params)}}).state("signup",{url:"/signup",params:{redirect:null},controller:function(a,b){a.signUpModal(b.params)}}).state("subscribe",{url:"/subscribe",params:{redirect:null},controller:function(a,b){a.subscribeModal(b.params)}}).state("termsOfService",{url:"/terms-of-service",views:{root:{templateUrl:"js/legal/termsOfService/partials/termsOfService.partial.html",controller:"termsOfServiceController"}}}).state("watchlist",{url:"/watchlist",templateUrl:"js/watchlist/partials/watchlist.html",controller:"watchlistController",resolve:{loginRequired:j,redirect:function(){return"watchlist"}}}).state("watchlist.questions",{url:"/questions/:postingId"}).state("watchlist.meetings",{url:"/meetings/:postingId"}).state("watchlist.splash",{url:"/:id",controller:"splashController",onEnter:k,onExit:l}),e.set({twistieCollapsedTpl:'<span class="glyphicon glyphicon-chevron-right"></span>',twistieExpandedTpl:'<span class="glyphicon glyphicon-chevron-down"></span>',twistieLeafTpl:"",defaultSelectedState:!1})}]),htsApp.directive("matchinput",function(){return{require:"ngModel",restrict:"A",scope:{matchinput:"="},link:function(a,b,c,d){a.$watch(function(){return d.$pristine&&angular.isUndefined(d.$modelValue)||a.matchinput===d.$modelValue},function(a){d.$setValidity("match",a)})}}}),htsApp.filter("tel",function(){return function(a){if(!a)return"";var b=a.toString().trim().replace(/^\+/,"");if(b.match(/[^0-9]/))return a;var c,d,e;switch(b.length){case 10:c=1,d=b.slice(0,3),e=b.slice(3);break;case 11:c=b[0],d=b.slice(1,4),e=b.slice(4);break;case 12:c=b.slice(0,3),d=b.slice(3,5),e=b.slice(5);break;default:return a}return 1==c&&(c=""),e=e.slice(0,3)+"-"+e.slice(3),(c+" ("+d+") "+e).trim()}}),htsApp.filter("cleanHeading",["$sce",function(a){return function(b){return b.replace(/\w\S*/g,function(b){var c=new RegExp("\\S+([0-9];)");if(c.test(b))return"";var d=b.charAt(0).toUpperCase()+b.substr(1).toLowerCase();return a.trustAsHtml(d)})}}]),htsApp.filter("cleanBody",["$sce",function(a){return function(b){return b=b.replace(/[\r\n]/g,"<br />"),b.replace(/\b([A-Z]{2,})\b/g,function(b){var c=new RegExp("\\S+([0-9];)");if(c.test(b))return"";var d=b.charAt(0).toUpperCase()+b.substr(1).toLowerCase();return a.trustAsHtml(d)})}}]),htsApp.filter("cleanBodyExcerpt",["$sce",function(a){return function(b){return b.replace(/\b([A-Z]{2,})\b/g,function(b){var c=new RegExp("\\S+([0-9];)");if(c.test(b))return"";var d=b.charAt(0).toUpperCase()+b.substr(1).toLowerCase();return a.trustAsHtml(d)})}}]),htsApp.directive("awesomebar",["$sce",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){function f(){var a=c.html();d.stripBr&&"<br>"===a&&(a=""),e.$setViewValue(a)}e&&(e.$render=function(){console.log("doing this"),e.$viewValue!==c.html()&&c.html(a.getTrustedHtml(e.$viewValue||""))},c.on("keydown keyup",function(a){if(13===parseInt(a.which)&&"keydown"===a.type){var c=angular.element(document.querySelector("#mentioMenu"));"none"===c[0].style.display?(console.log("mentio list closed.. submitting query"),b.awesomeBarSubmit()):"block"===c[0].style.display&&console.log("mentio list open"),a.preventDefault()}else b.$apply(f)}),f())}}}]),htsApp.directive("sellbox",["$sce","$window",function(a,b){return{restrict:"A",require:"?ngModel",link:function(c,d,e,f){function g(){var a=d.html();e.stripBr&&"<br>"===a&&(a=""),f.$setViewValue(a)}function h(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText||""}if(f){f.$render=function(){console.log("doing this"),f.$viewValue!==d.html()&&d.html(a.getTrustedHtml(f.$viewValue||""))};var i=b.JsDiff,j=!1;c.$watch("jsonObj.body",function(a,b){if(c.alerts=[],j){j=!1,console.log("==========Backspace Pressed==========");var d=h(b),e=h(a);if(console.log("Old Stripped",d),console.log("New Stripped",e),e){var f=i.diffWords(d,e);if(f.length){console.log(f);for(var g=0;g<f.length;g++){var k=f[g];if(k.removed)if(-1!==k.value.indexOf("#")){console.log("hasshtag removed ",k.value);var l=k.value.replace("#","");l=l.trim(),c.cleanModel("#",l)}else if(-1!==k.value.indexOf("$")){console.log("dollar removed ",k.value);var m=k.value.replace("$","");m=m.trim(),c.cleanModel("$",m)}else if(-1!==k.value.indexOf("@")){console.log("@ removed ",k.value);var n=k.value.replace("@","");n=n.trim(),c.cleanModel("@",n)}}}}else c.resetAll()}}),d.on("keydown keyup",function(a){8===parseInt(a.which)&&"keydown"===a.type&&(j=!0,console.log("setting backspace pressed to true")),c.$apply(g)}),g()}}}}]),htsApp.directive("dropzone",function(){return{link:function(a,b,c){var d,e;console.log("dropzone scope:",a),Dropzone.autoDiscover=!1,d=a[c.dropzone],e=new Dropzone(b[0],d.options),angular.forEach(d.eventHandlers,function(a,b){e.on(b,a)}),d.init=function(){e.processQueue()}}}}),htsApp.directive("dropdownMultiselect",["favesFactory",function(a){return{restrict:"E",scope:{selectedlabels:"=",userlabels:"=",selectedfaves:"=",placeholder:"=ngPlaceholder"},link:function(a,b){b.bind("click",function(a){a.stopPropagation()})},template:"<span class='dropdown' dropdown><i class='fa fa-tags dropdown-toggle' dropdown-toggle ng-click='open=!open;openDropdown()'>&nbsp;&nbsp;#Label</i><ul class='dropdown-menu'>   <input ng-model='query' type='text' autofocus class='labels-input' placeholder='Filter or Create New Labels'/>   <li ng-repeat='label in userlabels | filter:query' class='label-list'>       <a ng-click='setSelectedItem()'>           <span ng-click='deleteLabel($event)' class='fa fa-minus-circle pull-left delete-label'></span>#{{label.name}}           <span ng-class='isChecked(label.name)'><span/>       </a>   </li>   <li>       <a dropdown-toggle ng-click='createNewLabel(query)' ng-show='ifQueryUnique(query)'>{{query}} (create new)</a>   </li>   <li>       <a dropdown-toggle ng-click='applyChanges()' ng-show='updatesNecessary'>Apply</a>   </li></ul></span>",controller:["$scope","favesFactory","Session",function(a,b,c){a.currentFaves=c.userObj.user_settings.favorites,a.openDropdown=function(){a.selectedlabels=[],a.updatesNecessary=!1,console.log(a);var b=a.currentFaves;angular.forEach(a.selectedfaves,function(c,d){if(c)for(i=0;i<b.length;i++)if(b[i].postingId==d&&b[i].labels)for(j=0;j<b[i].labels.length;j++){var e=b[i].labels[j];_.contains(a.selectedlabels,e)||a.selectedlabels.push(e)}})},a.ifQueryUnique=function(b){var c=!0;return b?_.find(a.userlabels,function(a){a.name==b&&(c=!1)}):c=!1,c},a.createNewLabel=function(c){var d={name:c};b.addFavoriteLabel(d),a.userlabels=b.getUserLabels(),a.setSelectedItem(d.name),a.applyChanges(),a.query=""},a.setSelectedItem=function(b){console.log("in setSElectedItem"),a.updatesNecessary=!0,b||(b=this.label.name),_.contains(a.selectedlabels,b)?a.selectedlabels=_.without(a.selectedlabels,b):a.selectedlabels.push(b)},a.applyChanges=function(){var b=a.currentFaves;console.log("looping thought selected faves",a.selectedfaves),angular.forEach(a.selectedfaves,function(c,d){if(c)for(console.log("this item selected",c,d),i=0;i<b.length;i++)b[i].postingId==d&&(console.log(b[i].postingId,d),b[i].labels=a.selectedlabels)}),c.setSessionValue("favorites",b),a.selectedfaves={},a.updatesNecessary=!1},a.deleteLabel=function(c){c.stopPropagation();var d=this.label.name,e={name:d};b.removeFavoriteLabel(e,a.refreshTable)},a.refreshTable=function(){a.userlabels=b.getUserLabels(),b.refreshTable()},a.isChecked=function(b){return _.contains(a.selectedlabels,b)?"fa fa-check pull-right":!1}}]}}]),htsApp.directive("htsFaveToggle",function(){return{restrict:"E",template:'<span ng-class="{starHighlighted: favorited, star: !favorited}" ng-click="toggleFave(result); $event.stopPropagation();" tooltip="{{tooltipMessage}}" tooltip-placement="bottom" tooltip-trigger="mouseenter"></span>',controller:["$scope","$element","favesFactory","Session","authModalFactory","socketio","sideNavFactory","$timeout",function(a,b,c,d,e,f,g,h){d.userObj.user_settings.loggedIn&&c.checkFave(a.result,function(b){a.favorited=b,a.tooltipMessage="please wait",a.favorited?a.tooltipMessage="Remove from watch list":a.tooltipMessage="Add to watch list"}),a.toggleFave=function(b){d.userObj.user_settings.loggedIn?(console.log("favorited status: ",a.favorited),console.log(b),a.favorited?c.removeFave(b,function(){g.defaultMenu[2].active=!0,h(function(){g.defaultMenu[2].active=!1},250),a.favorited=!1,a.tooltipMessage="Add to watch list",f.leavePostingRoom(b.postingId,"inWatchList")}):c.addFave(b,function(){g.defaultMenu[2].active=!0,h(function(){g.defaultMenu[2].active=!1},250),a.favorited=!0,a.tooltipMessage="Remove from watch list",f.joinPostingRoom(b.postingId,"inWatchList")})):e.signInModal()}}]}}),htsApp.filter("capitalize",function(){return function(a,b){return a?a.replace(/([^\W_]+[^\s-]*) */g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):""}}),htsApp.directive("subMerchant",function(){return{templateUrl:"js/submerchant/partials/submerchant.partial.html",controller:["$scope","$http","$q","$timeout","$filter","Session","ENV",function(a,b,c,d,e,f,g){a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.$watch("subMerchForm.dob.$viewValue",function(b,c){if(b)if(b.length<=10){var d=b.slice(-1),e=!isNaN(d);console.log("is last char",d," a number? ",e),e?b&&c&&(1==c.length||4==c.length)&&(2==b.length||5==b.length)&&(a.subMerchantForm.individual.dateOfBirth=a.subMerchForm.dob.$viewValue+"/"):"/"===d?3==b.length||6==b.length?console.log("This forward slash inserted by system.  okay."):(console.log("forward slashed in wrong place"),a.subMerchantForm.individual.dateOfBirth=c):(console.log("user inserted invalid character"),a.subMerchantForm.individual.dateOfBirth=c)}else console.log("user inserted more than 10 chars"),a.subMerchantForm.individual.dateOfBirth=c}),a.$watch("subMerchantForm.destination.disperseType",function(b,c){"bank"===b?a.subMerchant.funding.destination="bank":"venmo"===b&&(a.subMerchant.funding.destination="email")}),a.subMerchantForm={business:{isbusinessAccount:null,businessOptionsDropdown:[{name:"No",value:!1},{name:"Yes",value:!0}],addressLookup:null},individual:{addressLookup:null,dateOfBirth:null},destination:{disperseToBank:null,disperseToVenmo:null},update:null},a.subMerchant={business:{legalName:null,taxId:null,address:{street_address:null,locality:null,region:null,postalCode:null}},individual:{firstName:null,lastName:null,email:null,dateOfBirth:null,address:{streetAddress:null,locality:null,region:null,postalCode:null}},funding:{destination:null,email:null,mobilePhone:null,accountNumber:null,routingNumber:null},tosAccepted:!0},a.convertIndividualDob=function(a,b){var c="",d="",e="",f="",g="";return"dashes"===b?(c=a.split("/"),d=c[0],e=c[1],f=c[2],g=f+"-"+d+"-"+e):"slashes"===b&&(c=a.split("-"),f=c[0],d=c[1],e=c[2],g=d+"/"+e+"/"+f),g},function(){a.recoveredMerchantAccount=f.getSessionValue("merchantAccount"),console.log(a.recoveredMerchantAccount),a.recoveredMerchantAccount.response.status&&("pending"===a.recoveredMerchantAccount.response.status?a.alerts.push({msg:"This account is currently pending approval.",type:"warning"}):"declined"===a.recoveredMerchantAccount.response.status&&a.alerts.push({msg:"This account is currently declined.",type:"danger"}),a.recoveredMerchantAccount.details.id&&(a.subMerchantForm.individual.dateOfBirth=a.convertIndividualDob(a.recoveredMerchantAccount.details.individual.dateOfBirth,"slashes"),console.log(a.recoveredMerchantAccount.details),a.subMerchant=a.recoveredMerchantAccount.details))}(),a.submitSubMerchant=function(){a.alerts=[],a.subMerchant.individual.dateOfBirth=a.convertIndividualDob(a.subMerchantForm.individual.dateOfBirth,"dashes"),b.post(g.paymentAPI+"/submerchant",{subMerchant:a.subMerchant,existingSubMerchant:a.recoveredMerchantAccount.response.id}).success(function(b){b.success?"pending"===b.merchantAccount.status&&(a.alerts.push({msg:"Congrats! Your seller account is pending approval, but don't let this stop you from posting now.",type:"success"}),a.$dismiss&&a.$dismiss("subMerchantModalSuccess",b),f.getUserFromServer().then(function(a){f.create(a)})):a.alerts.push({msg:b.message,type:"danger"})}).error(function(b){a.alerts.push({msg:b.message,type:"danger"})})},a.predictAddress=function(b){return a.predictPlace(b).then(function(a){return a.map(function(a){return a})})},a.predictPlace=function(a){var b=new google.maps.LatLngBounds(new google.maps.LatLng(37.79738,-122.52464),new google.maps.LatLng(37.68879,-122.36122)),d={input:a,bounds:b,componentRestrictions:{country:"US"}},e=new google.maps.places.AutocompleteService,f=c.defer();return e.getPlacePredictions(d,function(a,b){f.resolve(a)}),f.promise},a.setAddressComponents=function(b,c){console.log(b),console.log(c);var d=new google.maps.places.PlacesService(new google.maps.Map(document.createElement("map-canvas"))),e={placeId:b.place_id};d.getDetails(e,function(b,d){for(var e="",f="",g=0;g<b.address_components.length;g++){var h=b.address_components[g];console.log(h);for(var i=0;i<h.types.length;i++){var j=h.types[i];if(console.log(a.subMerchant),"locality"===j){a.subMerchant[c].address.locality=h.long_name;break}if("administrative_area_level_1"===j){a.subMerchant[c].address.region=h.short_name;break}if("route"===j){e=h.long_name;break}if("postal_code"===j){a.subMerchant[c].address.postalCode=h.long_name;break}if("street_number"===j){f=h.long_name;break}}}a.subMerchant[c].address.streetAddress=f+" "+e})}}]}}),htsApp.filter("awesomecity",function(){return function(a){var b;return b=a?a.replace(/,[^,]+$/,""):"Nearby"}}),htsApp.directive("onlyDigits",function(){return{require:"ngModel",restrict:"A",link:function(a,b,c,d){function e(a){if(a){var b=a.replace(/\/[^0-9]/g,"");return b!==a&&(d.$setViewValue(b),d.$render()),parseInt(b,10)}return void 0}d.$parsers.push(e)}}}),htsApp.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),angular.module("globalVars",[]).constant("ENV",{name:"staging",htsAppUrl:"https://staging.hashtagsell.com",postingAPI:"https://staging-posting-api.hashtagsell.com/v1/postings/",userAPI:"https://staging-posting-api.hashtagsell.com/v1/users/",freeGeoIp:"https://staging-freegeoip.hashtagsell.com/json/",realtimePostingAPI:"https://staging-realtime-svc.hashtagsell.com/postings",realtimeUserAPI:"https://staging-realtime-svc.hashtagsell.com/users",groupingsAPI:"https://staging-posting-api.hashtagsell.com/v1/groupings/",annotationsAPI:"https://staging-posting-api.hashtagsell.com/v1/annotations",feedbackAPI:"https://staging.hashtagsell.com/feedback",paymentAPI:"https://staging.hashtagsell.com/payments",precacheAPI:"https://staging.hashtagsell.com/precache",facebookAuth:"https://staging.hashtagsell.com/auth/facebook",twitterAuth:"https://staging.hashtagsell.com/auth/twitter",ebayAuth:"https://staging.hashtagsell.com/auth/ebay",ebayRuName:"HashtagSell__In-HashtagS-e6d2-4-sdojf",ebaySignIn:"https://signin.sandbox.ebay.com/ws/eBayISAPI.dll",fbAppId:"459229800909426"}).constant("clientTokenPath","https://staging.hashtagsell.com/payments/client_token"),htsApp.factory("authModalFactory",["Session","$modal","$log","$state","$rootScope",function(a,b,c,d,e){var f={};return f.signInModal=function(a){var f=b.open({templateUrl:"/js/authModals/modals/signInModal/partials/signIn.html",controller:"signInModalController",size:"sm",keyboard:!1,backdrop:"static",backdropClass:"translucent-modal-backdrop",resolve:{params:function(){return a}}});f.result.then(function(a){},function(b){console.log(b),"signUp"===b?d.go("signup",{redirect:a.redirect}):"forgot"===b?d.go("forgot",{redirect:a.redirect}):"signIn"===b?d.go("signin",{redirect:a.redirect}):"successful login"===b&&a.redirect?d.go(a.redirect):"successful login"!==b||a.redirect||d.go("feed"),c.info("Modal dismissed at: "+new Date)}),e.$on("$stateChangeStart",function(a,b,c,d,e){f.dismiss("direct")})},f.betaCheckModal=function(a){var f=b.open({templateUrl:"/js/authModals/modals/betaCheckModal/partials/betaCheck.html",controller:"betaCheckModalController",size:"lg",keyboard:!1,backdrop:"static",backdropClass:"translucent-modal-backdrop"});f.result.then(function(a){},function(b){"signUp"===b?d.go("signup",{redirect:a.redirect}):"subscribe"===b&&d.go("subscribe",{redirect:a.redirect}),c.info("Modal dismissed at: "+new Date)}),e.$on("$stateChangeStart",function(a,b,c,d,e){f.dismiss("direct")})},f.signUpModal=function(a){var f=b.open({templateUrl:"/js/authModals/modals/signUpModal/partials/signUp.html",controller:"signupModalController",size:"sm",keyboard:!1,backdrop:"static",backdropClass:"translucent-modal-backdrop"});f.result.then(function(a){},function(b){"success"===b?d.go("checkemail"):"forgot"===b?d.go("forgot",{redirect:a.redirect}):"signIn"===b?d.go("signin",{redirect:a.redirect}):"subscribe"===b&&d.go("subscribe",{redirect:a.redirect}),c.info("Modal dismissed at: "+new Date)}),e.$on("$stateChangeStart",function(a,b,c,d,e){f.dismiss("direct")})},f.subscribeModal=function(a){var f=b.open({templateUrl:"/js/authModals/modals/subscribeModal/partials/subscribe.html",controller:"subscribeModalController",size:"sm",keyboard:!1,backdrop:"static",backdropClass:"translucent-modal-backdrop"});f.result.then(function(a){},function(b){"success"===b?d.go("checkemail"):"signUp"===b?d.go("signup",{redirect:a.redirect}):"signIn"===b&&d.go("signin",{redirect:a.redirect}),c.info("Modal dismissed at: "+new Date)}),e.$on("$stateChangeStart",function(a,b,c,d,e){f.dismiss("direct")})},f.checkEmailModal=function(){var a=b.open({templateUrl:"/js/authModals/modals/checkEmailModal/partials/checkEmail.html",controller:"checkEmailController",size:"sm",keyboard:!1,backdrop:"static",backdropClass:"translucent-modal-backdrop"});a.result.then(function(a){},function(a){c.info("Modal dismissed at: "+new Date)}),e.$on("$stateChangeStart",function(b,c,d,e,f){a.dismiss("direct")})},f.forgotPasswordModal=function(a){var f=b.open({templateUrl:"/js/authModals/modals/forgotPasswordModal/partials/forgotPassword.html",controller:"forgotPasswordController",size:"sm",keyboard:!1,backdrop:"static",backdropClass:"translucent-modal-backdrop",resolve:{params:function(){return a}}});f.result.then(function(a){},function(b){"success"===b?d.go("checkemail"):"signUp"===b?d.go("signup",{redirect:a.redirect}):"signIn"===b&&d.go("signin",{redirect:a.redirect}),c.info("Modal dismissed at: "+new Date)}),e.$on("$stateChangeStart",function(a,b,c,d,e){f.dismiss("direct")})},f.resetPasswordModal=function(a,f){var g=b.open({templateUrl:"/js/authModals/modals/resetPasswordModal/partials/resetPassword.html",controller:"resetPasswordModalController",size:"sm",keyboard:!1,backdrop:"static",backdropClass:"translucent-modal-backdrop",resolve:{token:function(){return f}}});g.result.then(function(a){},function(a){console.log(a),a.success&&d.go("signin",{redirect:"feed",email:a.email}),c.info("Modal dismissed at: "+new Date)}),e.$on("$stateChangeStart",function(a,b,c,d,e){g.dismiss("direct")})},f}]),htsApp.controller("betaCheckModalController",["$scope","$modalInstance",function(a,b){a.dismiss=function(a){b.dismiss(a)}}]),htsApp.controller("checkEmailController",["$scope","$modalInstance",function(a,b){a.dismiss=function(a){b.dismiss(a)}}]),htsApp.controller("forgotPasswordController",["$scope","$modalInstance","authFactory","params",function(a,b,c,d){d.msg&&(a.message="This activation email link has already been used.  Sign in or reset your password."),a.forgotPassword=function(b){if(b){var d=a.email;c.passwordReset(d).then(function(b){b.error?a.message=b.error:b.success&&a.dismiss("success")},function(){a.message="Please contact support.  Sorry for the trouble"})}},a.dismiss=function(a){b.dismiss(a)}}]),htsApp.controller("resetPasswordModalController",["$scope","$modalInstance","authFactory","token",function(a,b,c,d){a.resetPassword=function(b){if(b){var e=a.newPassword;c.changePassword(e,d).then(function(b){console.log(b),b.error?a.message=b.error:b.success&&a.dismiss(b)},function(){a.message="Please contact support.  Sorry for the trouble"})}},a.dismiss=function(a){b.dismiss(a)}}]),htsApp.controller("signInModalController",["$scope","$modalInstance","$window","authFactory","params",function(a,b,c,d,e){e.email&&(a.email=e.email),a.loginPassport=function(b){if(b){var c=a.email,e=a.password;d.login(c,e).then(function(b){b.error?a.message=b.error:b.success&&a.dismiss("successful login")},function(){a.message="Ooops.. Login error, please contact support."})}},a.dismiss=function(a){b.dismiss(a)}}]),htsApp.controller("signupModalController",["$scope","$modalInstance","authFactory","Notification",function(a,b,c,d){a.signupPassport=function(b){if(b){var e=a.email,f=a.password,g=a.name,h=a.secret,i=a.betaAgreement;console.log(e,f,h,g,i),c.signUp(e,f,g,h,i).then(function(b){console.log(b),b.error?a.message=b.error:b.success&&a.dismiss("success")},function(){d.error({message:"Appears we're having sign up issues.  Please check back soon.",delay:1e4})})}},a.dismiss=function(a){b.dismiss(a)}}]),htsApp.controller("subscribeModalController",["$scope","$modalInstance","authFactory","Notification",function(a,b,c,d){a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.subscribe=function(b){if(b){var e=a.email;c.subscribe(e).then(function(b){console.log(b),b.success?b.success&&a.alerts.push({type:"success",msg:b.message}):a.alerts.push({type:"danger",msg:b.message})},function(){d.error({message:"Whoops.. Can't take new subscribers right meow.. We're working on this.",delay:1e4})})}},a.dismiss=function(a){b.dismiss(a)}}]),htsApp.factory("authFactory",["$http","Session","$q","$window",function(a,b,c){var d={};return d.login=function(d,e){var f=c.defer();return a.post("/login",{email:d,password:e}).then(function(a){a.data.success?(b.create(a.data),console.log("PASSPORT RESPONSE",a),f.resolve(a.data)):f.resolve(a.data)},function(a,b,c,d){f.reject()}),f.promise},d.signUp=function(b,d,e,f){var g=c.defer();return a.post("/signup",{email:b,password:d,name:e,secret:f}).then(function(a){a.data&&g.resolve(a.data)},function(a,b,c,d){g.reject()}),g.promise},d.subscribe=function(b){var d=c.defer();return a.post("/subscribe",{email:b}).then(function(a){a.data&&d.resolve(a.data)},function(a,b,c,e){d.reject()}),d.promise},d.passwordReset=function(b){var d=c.defer();return a.post("/forgot",{email:b}).then(function(a){a.data&&d.resolve(a.data)},function(a,b,c,e){d.reject()}),d.promise},d.changePassword=function(b,d){var e=c.defer();return a.post("/reset",{password:b,token:d}).then(function(a){a.data&&e.resolve(a.data)},function(a,b,c,d){e.reject()}),e.promise},d.updatePassword=function(b,d){var e=c.defer();return a.post("/reset",{currentPassword:b,newPassword:d}).then(function(a){a.data&&e.resolve(a.data)},function(a,b,c,d){e.reject()}),e.promise},d}]),htsApp.controller("awesomeBarController",["$window","$scope","$location","awesomeBarFactory","searchFactory","$state",function(a,b,c,d,e,f){function g(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText||""}b.clearCity=function(){b.queryObj.city=null,b.queryObj.locationObj=null},b.queryObj=d.queryObj,b.awesomeBarSubmit=function(){if(b.advancedSearch.visible=!1,b.queryObj.q){console.log("before sanatize",b.queryObj),e.resetResultsView();var a=b.queryObj.q,c=g(b.queryObj.q);console.log("stripped html",c);var d=c.replace("@"+b.queryObj.city,"").trim();console.log("trimmed string",d),b.queryObj.q=d,console.log("after sanatize",b.queryObj),f.go("results",b.queryObj),b.queryObj.q=a}},b.validateQueryObj=function(){b.queryObj.locationObj&&-1===b.queryObj.q.indexOf("@")&&(b.queryObj.city=null,b.queryObj.locationObj=null)},b.map=d.googleMap,b.searchPlaces=function(a){return a?d.predictPlace(a).then(function(a){return b.cities=a,a.map(function(a){return a})}):void 0},b.getCityMetaData=function(a){return console.log("selected city: ",a),d.getCityMetaData(a).then(function(c){b.queryObj.city=a.description,b.queryObj.locationObj=c}),'<span class="mention-highlighter-location" contentEditable="false">@'+a.description+"</span>"},b.advancedSearch={visible:!1}}]),htsApp.factory("awesomeBarFactory",["$q","$http","$stateParams",function(a,b,c){var d={};return d.queryObj={q:c.q||"I'm searching for...",city:null,locationObj:null,price:{min:null,max:null}},d.googleMap=new google.maps.Map(document.createElement("map-canvas")),d.predictPlace=function(b){var c={input:b,types:["(cities)"],componentRestrictions:{country:"us"}},d=new google.maps.places.AutocompleteService,e=a.defer();return d.getPlacePredictions(c,function(a,b){e.resolve(a)}),e.promise},d.getCityMetaData=function(b){var c=new google.maps.places.PlacesService(d.googleMap),e={placeId:b.place_id},f=a.defer();return c.getDetails(e,function(a,b){f.resolve(a)}),f.promise},d}]),htsApp.controller("categorySelectorBar",["$scope","$rootScope","$state","Session","ivhTreeviewMgr","authModalFactory","categoryFactory",function(a,b,c,d,e,f,g){function h(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}b.$on("$stateChangeSuccess",function(b,c,d,e,f){"feed"===c.name||"feed.splash"===c.name?a.showCategorySelectorBar=!0:a.showCategorySelectorBar=!1}),a.feedCategoryObj={},a.feedCategoryObj.userDefaultCategories=d.userObj.user_settings.feed_categories,a.getAllCategoriesFromServer=function(){g.lookupCategories().then(function(b){200!==b.status?console.log(b.data.error):200===b.status&&(a.feedCategoryObj.nestedCategories=i(b.data.results),console.log(a.feedCategoryObj.nestedCategories))},function(a){console.log(a),console.log("category lookup error")})},a.getAllCategoriesFromServer();var i=function(a){for(var b=d.userObj.user_settings.safe_search,c=[],f=0;f<a.length;f++){var g=a[f];switch(g.code){case"SSSS":case"VVVV":case"RRRR":case"MMMM":case"PPPP":if(b&&"PPPP"===g.code||b&&"MMMM"===g.code)continue;g.name=h(g.name),g.selected=j(g.code);for(var i=0;i<g.categories.length;i++){var k=g.categories[i];k.name=h(k.name),k.selected=j(k.code),k.selected&&(g.selected=!0)}c.push(g)}}return e.validate(c),console.log(c),c},j=function(b){for(var c=0;c<a.feedCategoryObj.userDefaultCategories.length;c++){if(a.feedCategoryObj.userDefaultCategories[c].code===b)return!0;if(c===a.feedCategoryObj.userDefaultCategories.length-1)return!1}};a.categoryOnChange=function(b,f,g){if(console.log(b,f,g),d.userObj.user_settings.loggedIn){
var h=[];for(t=0;t<g.length;t++)if(g[t].selected)h.push({name:g[t].name,code:g[t].code});else for(u=0;u<g[t].categories.length;u++)g[t].categories[u].selected&&h.push({name:g[t].categories[u].name,code:g[t].categories[u].code});console.log(h),d.setSessionValue("feed_categories",h,function(a){200!==a.status&&alert("could not remove category from user feed.  please notify support.")})}else e.deselect(a.feedCategoryObj.nestedCategories,b.name,!1),c.go("signup")},a.expandTree=function(){e.expandRecursive(a.feedCategoryObj.nestedCategories)},a.$watch("filterCategories",function(b,c){""===b&&e.collapseRecursive(a.feedCategoryObj.nestedCategories)})}]),htsApp.controller("feed.controller",["$scope","feedFactory","splashFactory","$state","$interval",function(a,b,c,d,e){a.status=b.status;var f=function(){if(a.currentDate=Math.floor(Date.now()/1e3),!a.results&&b.persistedResults){console.log("recovering from persisted results",b.persistedResults),a.results=b.persistedResults;var c=!0}else a.results||(b.status.pleaseWait=!0);b.poll().then(function(d){if(200!==d.status)a.status.pleaseWait=!1,a.status.error.message=":( Oops.. Something went wrong.",a.status.error.trace=d.data.error;else if(200===d.status)if(!a.results||c){for(i=0;i<d.data.external.postings.length;i++){var g=d.data.external.postings[i];if(0===g.images.length)g.feedItemHeight=179;else if(1===g.images.length)g.feedItemHeight=261,"CRAIG"===g.username&&(g.images[0].full&&(g.images[0].full=g.images[0].full.replace(/^http:\/\//i,"//")),g.images[0].thumb&&(g.images[0].thumb=g.images[0].thumb.replace(/^http:\/\//i,"//")),g.images[0].images&&(g.images[0].images=g.images[0].images.replace(/^http:\/\//i,"//")));else if(g.feedItemHeight=420,"CRAIG"===g.username)for(var h=0;h<g.images.length;h++){var j=g.images[h];j.full&&(j.full=j.full.replace(/^http:\/\//i,"//")),j.thumb&&(j.thumb=j.thumb.replace(/^http:\/\//i,"//")),j.images&&(j.images=j.images.replace(/^http:\/\//i,"//"))}c&&a.results.unshift(g)}b.status.pleaseWait=!1,c||(a.results=d.data.external.postings),b.persistedResults=a.results.slice(0,300),c=!1;var k=e(f,6e4,0,!0);a.$on("$destroy",function(){console.log("pausing feed updates"),e.cancel(k)})}else{var l=jQuery(".inner-container").scrollTop();for(i=0;i<d.data.external.postings.length;i++)0===d.data.external.postings[i].images.length?(d.data.external.postings[i].feedItemHeight=179,l+=179):1===d.data.external.postings[i].images.length?(d.data.external.postings[i].feedItemHeight=216,l+=216):(d.data.external.postings[i].feedItemHeight=420,l+=420),a.results.unshift(d.data.external.postings[i]);jQuery(".inner-container").scrollTop(l),b.persistedResults=a.results.slice(0,300),console.log("persisted results are: ",b.persistedResults)}},function(a){console.log(a)})};f(),a.openSplash=function(a){c.result=a.result,console.log(c.result),d.go("feed.splash",{id:a.result.postingId})}}]),htsApp.filter("secondsToTimeString",function(){return function(a){var b=Math.floor(a/86400),c=Math.floor(a%86400/3600),d=Math.floor(a%86400%3600/60),e="";return b>0&&(e+=b>1?b+" days ":b+" day "),c>0&&(e+=c>1?c+" hours ":c+" hour "),d>=0&&(e+=d>1?d+" minutes ":d+" minute "),e}}),htsApp.factory("feedFactory",["$http","$stateParams","$location","$q","Session",function(a,b,c,d,e){var f={};return f.status={pleaseWait:!0},f.queryParams={},f.poll=function(){var b=d.defer(),g="",h="",j="";for(i=0;i<e.userObj.user_settings.feed_categories.length;i++)"AAAA"==e.userObj.user_settings.feed_categories[i].code||"CCCC"==e.userObj.user_settings.feed_categories[i].code||"DISP"==e.userObj.user_settings.feed_categories[i].code||"SSSS"==e.userObj.user_settings.feed_categories[i].code||"JJJJ"==e.userObj.user_settings.feed_categories[i].code||"MMMM"==e.userObj.user_settings.feed_categories[i].code||"PPPP"==e.userObj.user_settings.feed_categories[i].code||"RRRR"==e.userObj.user_settings.feed_categories[i].code||"SVCS"==e.userObj.user_settings.feed_categories[i].code||"ZZZZ"==e.userObj.user_settings.feed_categories[i].code||"VVVV"==e.userObj.user_settings.feed_categories[i].code?h+=e.userObj.user_settings.feed_categories[i].code+"|":j+=e.userObj.user_settings.feed_categories[i].code+"|";return e.userObj.user_settings.safe_search&&(h+="~PPPP|~MMMM"),g=c.protocol()+"://"+c.host()+":"+c.port()+"/userfeed?category_group="+h+"&category="+j,f.queryParams.anchor&&(g+="&anchor="+f.queryParams.anchor,g+="&cityCode="+f.queryParams.cityCode),a({method:"GET",url:g}).then(function(a,c,d,e){console.log("polling response",a),a.data.error?(f.status.pleaseWait=!1,f.status.error.message=":( Oops.. Something went wrong.",f.status.error.trace=a.data.error.response.error,b.reject(a)):(f.queryParams.anchor=a.data.external.anchor,f.queryParams.cityCode=a.data.location.cityCode,b.resolve(a))},function(a,c,d,e){b.reject(a)}),b.promise},f}]),htsApp.controller("feedbackController",["$scope","feedbackFactory","$http","ENV","Notification","Session",function(a,b,c,d,e,f){a.feedback=b.feedback,a.userObj=f.userObj,a.submitFeedback=function(){a.feedback.form.user=a.userObj.user_settings.name,c.post(d.feedbackAPI,a.feedback).success(function(b){b.success?(a.feedback.form.visible=!1,a.feedback.form.generalFeedback=null,e.primary({title:"Feedback Sent!",message:"You'll receive an email shortly.",delay:6e3})):b.error&&e.error({title:"Could not submit your feedback",message:b.error,delay:1e4})}).error(function(a){e.error({title:"Could not submit your feedback",message:"Sorry! Something is big time wrong. Email us at feedback@hashtagsell.com.",delay:1e4})})}}]),htsApp.factory("feedbackFactory",function(){var a={};return a.feedback={form:{user:null,generalFeedback:null,visible:!1}},a}),htsApp.controller("filterBar",["$scope","$rootScope","searchFactory","$timeout","sideNavFactory",function(a,b,c,d,e){b.$on("$stateChangeSuccess",function(b,c,d,e,f){"results"===c.name||"results.splash"===c.name?a.showFilterBar=!0:a.showFilterBar=!1}),a.filterToggles=c.filter,a.$watchGroup(["filterToggles.mustHaveImage","filterToggles.mustHavePrice"],function(b,d,e){console.log(a.filterToggles),c.filterArray(a.views,"filter")}),a.views=c.views,a.$watchGroup(["views.gridView","views.showMap"],function(){"results"===b.currentState&&d(function(){c.filterArray(a.views,"resize"),a.views.gridView?e.sideNav.listView=!1:!a.views.gridView&&a.views.showMap?e.sideNav.listView=!1:a.views.gridView||a.views.showMap||(e.sideNav.listView=!0)},1)}),a.rangeSlider=c.priceSlider,console.log(a.rangeSlider),a.slideDelegate=function(b){console.log(b),c.priceSlider.userSetValue=!0,console.log(c.priceSlider),c.filterArray(a.views,"filter")},a.myFormatter=function(a){return"$"+a}}]),htsApp.controller("betaAgreementController",["$scope","ENV",function(a,b){}]),htsApp.controller("postingRulesController",["$scope","ENV",function(a,b){}]),htsApp.controller("privacyPolicyController",["$scope","ENV",function(a,b){a.legalUrl={privacyPolicy:b.htsAppUrl+"/privacy-policy",postingRules:b.htsAppUrl+"/posting-rules",betaAgreement:b.htsAppUrl+"/beta-agreement",termsOfServiceUrl:b.htsAppUrl+"/terms-of-service"}}]),htsApp.controller("termsOfServiceController",["$scope","ENV",function(a,b){a.legalUrl={privacyPolicy:b.htsAppUrl+"/privacy-policy",postingRules:b.htsAppUrl+"/posting-rules",betaAgreement:b.htsAppUrl+"/beta-agreement",termsOfServiceUrl:b.htsAppUrl+"/terms-of-service"}}]),htsApp.controller("mainController",["$scope","$rootScope","sideNavFactory","$timeout","Session","socketio","myPostsFactory","favesFactory","metaFactory","$window",function(a,b,c,d,e,f,g,h,i,j){a.userObj=e.userObj,a.sideNav=c.sideNav,a.toggleOffCanvasSideNav=function(){a.sideNav.hidden=!a.sideNav.hidden},b.$on("$stateChangeStart",function(e,f,g,h,k){if(b.previousState=h.name||"feed",b.currentState=f.name,b.toParams=g,b.fromParams=k,b.event=e,console.log("============= State Change Start =============="),console.log("State change event",b.event),console.log("Previous state:"+b.previousState,"Params",b.fromParams),console.log("Current state:"+b.currentState,"Params",b.toParams),console.log("============= State Change Done =============="),d(function(){i.metatags.facebook.url=j.location.href},50),c.updateSideNav(f),c.settingsMenu[0].link=b.previousState,"feed.splash"!==b.currentState&&"results.splash"!==b.currentState&&("feed"===b.currentState?a.sideNav.listView=!0:"results.splash"===b.previousState||"feed.splash"===b.previousState?console.log("do nothing"):a.sideNav.listView=!1),a.sideNav.hidden=!0,"results"===f.name)d(function(){var a,b=angular.element(document.getElementsByClassName("navbar-fixed-top")),c=angular.element(document.getElementsByClassName("inner-container")),d=angular.element(document.getElementsByClassName("sidebar-container")),e=0,f=!1,g=function(){return a=c.scrollTop(),a>e?(e=a,!1):(e=a,!0)};c.on("scroll",function(){var a=g(),e=c.scrollTop();f&&a?(b.removeClass("hide-navbar"),d.removeClass("sidebar-container-roll-up"),f=!1):e>=50&&!f&&!a&&(b.addClass("hide-navbar"),d.addClass("sidebar-container-roll-up"),f=!0)})},250);else{var l=angular.element(document.getElementsByClassName("navbar-fixed-top")),m=angular.element(document.getElementsByClassName("sidebar-container"));l.removeClass("hide-navbar"),m.removeClass("sidebar-container-roll-up")}}),a.userObj.user_settings.loggedIn&&e.getUserFromServer().then(function(a){e.create(a)}),a.$watch("userObj.user_settings.loggedIn",function(a,b){if(a)f.init(e.userObj.user_settings.name),g.getAllUserPosts(e.userObj.user_settings.name).then(function(a){for(var b=0;b<g.userPosts.data.length;b++){var c=g.userPosts.data[b];f.joinPostingRoom(c.postingId,"postingOwner")}}),_.each(h.currentFavorites,function(a){f.joinPostingRoom(a.postingId,"inWatchList")});else if(f.cachedUsername){if(f.closeAllConnections(),g.userPosts.data.length)for(var c=0;c<g.userPosts.data.length;c++){var d=g.userPosts.data[c];f.leavePostingRoom(d.postingId,"postingOwner")}_.each(h.currentFavorites,function(a){f.leavePostingRoom(a.postingId,"inWatchList")})}},!0)}]),htsApp.controller("metaController",["$scope","metaFactory",function(a,b){a.metatags=b.metatags}]),htsApp.factory("metaFactory",function(){var a={};return a.metatags={page:{title:"HashtagSell · Rethinking Online Classifieds",description:"HashtagSell.com is rethinking the way people buy and sell online.  Search millions of online classifieds in seconds!  Sell your next item with HashtagSell.com.",googleVerification:"QEL7PxohhyFKyG5zg8Utt8ohbB_HzYjdYUnDXdhFBt0",faviconUrl:"https://static.hashtagsell.com/htsApp/favicon/favicon.ico"},facebook:{title:"HashtagSell Online Classifieds",image:"https://static.hashtagsell.com/logos/hts/HashtagSell_Logo_Home.png",site_name:"HashtagSell.com",description:"HashtagSell.com is rethinking the way people buy and sell online.  Search millions of online classifieds in seconds!  Sell your next item with HashtagSell.com.",url:null},twitter:{card:"summary_large_image",site:"@hashtagsell",description:"HashtagSell.com is rethinking the way people buy and sell online.  Search millions of online classifieds in seconds!  Sell your next item with HashtagSell.com.",title:"HashtagSell.com - Rethinking Online Classifieds",creator:"@hashtagsell",image:"https://static.hashtagsell.com/logos/hts/HashtagSell_Logo_Home.png"}},a}),htsApp.controller("myPosts.controller",["$scope","$rootScope","$filter","$modal","$window","myPostsFactory","Session","socketio","ngTableParams","newPostFactory","Notification","splashFactory","$state",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.userPosts=f.userPosts,a.userObj=g.userObj,console.log(a.userPosts),f.tableParams=new i({page:1,count:2e3,filter:{},sorting:{}},{counts:[],total:a.userPosts.data.length,getData:function(b,d){var e=c("filter")(a.userPosts.data,f.filterString),g=d.sorting()?c("orderBy")(e,d.orderBy()):e;d.total(g.length),b.resolve(g.slice((d.page()-1)*d.count(),d.page()*d.count()))}}),a.tableParams=f.tableParams,a.tableParams.settings().$scope=a,a.filters={$:""},a.$watch("filters.$",function(b){f.filterString=b,console.log(f.filterString),a.tableParams.reload()}),a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.currentState=c.name,a.expandedPostingId=d.postingId}),a.newPost=function(){if(a.userObj.user_settings.loggedIn){var b=d.open({templateUrl:"/js/newPost/modals/newPost/partials/newPost.html",controller:"newPostModal",size:"lg",keyboard:!1,backdrop:"static",resolve:{mentionsFactory:function(){return j}}});b.result.then(function(a){},function(b){"stageOneSuccess"===b.reason&&a.pushtoExternalService(b.post),console.log("Modal dismissed at: "+new Date)})}else m.go("signup")},a.expandCollapseQuestions=function(a,c){a.stopPropagation(),"myposts.questions"!==b.currentState?(c.currentlyViewing={questions:!0,meetings:!1},m.go("myposts.questions",{postingId:c.postingId})):(c.currentlyViewing={questions:!1,meetings:!1},m.go(b.previousState))},a.expandCollapseMeetingRequests=function(a,c){a.stopPropagation(),"myposts.meetings"!==b.currentState?(c.currentlyViewing={questions:!1,meetings:!0},m.go("myposts.meetings",{postingId:c.postingId})):(c.currentlyViewing={questions:!1,meetings:!1},m.go(b.previousState))},a.countUnreadQuestions=function(a){for(var b=0,c=0;c<a.questions.results.length;c++){var d=a.questions.results[c];d.answers.length||b++}return b},a.countUnreadOffers=function(a){for(var b=0,c=0;c<a.offers.results.length;c++){var d=a.offers.results[c];b++;for(var e=0;e<d.proposedTimes.length;e++){var f=d.proposedTimes[e];f.acceptedAt&&b--}}return b},a.deletePost=function(a){console.log(a),f.deletePost(a).then(function(b){204===b.status?(h.leavePostingRoom(a.postingId,"postingOwner"),f.getAllUserPosts(g.userObj.user_settings.name).then(function(a){200===a.status||(k.error({title:"Whoops",message:"Please notify support.  We coulnd't refresh your myPosts list after deleting an item.",delay:1e4}),alert("could not refresh myPost list after deleting item.  contact support."))})):k.error({title:"Whoops",message:"Please notify support.  We coulnd't delete your item for some reason.",delay:1e4})})},a.editPost=function(a){k.error({title:"Coming soon",message:"Please delete and recreate the ad for now.  We're rolling out edit functionality soon! :)",delay:1e4})},a.openSplash=function(a){l.result=a,console.log(l.result),m.go("myposts.splash",{id:a.postingId})},a.showFacebookPost=function(a){e.open("http://facebook.com")},a.removeFacebookPost=function(a){},a.showTwitterPost=function(a){e.open("http://twitter.com")},a.removeTwitterPost=function(a){},a.showEbayPost=function(a){e.open(a.ebay.url)},a.removeEbayPost=function(a){}}]),htsApp.factory("myPostsFactory",["$http","ENV","$q","utilsFactory","sideNavFactory","profileFactory",function(a,b,c,d,e,f){var g={};return g.userPosts={data:[],updateMyPostsBadgeCount:function(){var a=0;if(this.data.length)for(var b=0;b<this.data.length;b++){var c=this.data[b];if(c.questions.results.length)for(var d=0;d<c.questions.results.length;d++){var f=c.questions.results[d];f.answers.length||a++}if(c.offers.results.length)for(var g=0;g<c.offers.results.length;g++){var h=c.offers.results[g];a++;for(var i=0;i<h.proposedTimes.length;i++){var j=h.proposedTimes[i];j.acceptedAt&&a--}}}return e.items[1].alerts=a,a}},g.getAllUserPosts=function(f){var h=c.defer(),i={filters:{mandatory:{exact:{username:f}}}};return a({method:"GET",url:b.postingAPI+d.bracketNotationURL(i)}).then(function(a){var b=a.data.results;if(b.length){g.userPosts.data.length&&(g.userPosts.data=[]);for(var c=0;c<b.length;c++){var d=b[c];g.getPostingIdQuestionsAndOffers(d.postingId).then(function(a){var c=a.data;g.userPosts.data.push(c),g.userPosts.updateMyPostsBadgeCount(),g.userPosts.data.length===b.length&&(g.tableParams&&g.tableParams.reload(),console.log(f+" items for sale:",g.userPosts),h.resolve(a))})}}else g.userPosts.data=[],e.items[1].alerts=0},function(a){h.reject(a)}),h.promise},g.getPostingIdQuestionsAndOffers=function(e){var g=c.defer(),h={postingId:e,questions:!0,offers:!0,count:100};return a({method:"GET",url:b.postingAPI+e+d.bracketNotationURL(h)}).then(function(a,b,c,d){if(200===a.status){if(a.data.questions.results.length)for(var e=0,h=0;h<a.data.questions.results.length;h++)f.getUserProfile(a.data.questions.results[h].username).then(function(b){e++,200===b.status&&(a.data.questions.results[e-1].userProfile=b.data.user),e===a.data.questions.results.length&&(a.data.offers.results.length||g.resolve(a))});if(a.data.offers.results.length)for(var i=0,j=0;j<a.data.offers.results.length;j++)f.getUserProfile(a.data.offers.results[j].username).then(function(b){i++,200===b.status&&(a.data.offers.results[i-1].userProfile=b.data.user),i===a.data.offers.results.length&&g.resolve(a)});else g.resolve(a)}else g.reject(a)},function(a,b,c,d){g.reject(a)}),g.promise},g.deletePost=function(d){var e=c.defer();return a({method:"DELETE",url:b.postingAPI+d.postingId}).then(function(a,b,c,d){console.log("delete response: ",a),e.resolve(a)},function(a,b,c,d){e.reject(a)}),e.promise},g}]),htsApp.controller("myPosts.meetings.controller",["$scope","meetingsFactory","myPostsFactory","socketio","$state","Session","Notification",function(a,b,c,d,e,f,g){function h(a){return!a||/^\s*$/.test(a)}a.userObj=f.userObj,a.acceptOffer=function(a,e){b.acceptOffer(a,e).then(function(b){201===b.status?(c.getAllUserPosts(f.userObj.user_settings.name),g.primary({title:"Meeting Request Accepted!",message:"We've notified @"+a.username+".  Expect an email shortly.",delay:7e3}),h(a.message)||d.sendMessage(recipient,a.message)):(console.log(b),g.error({title:b.name,message:b.message,delay:2e4}))},function(a){console.log(a),g.error({title:a.data.name,message:a.data.message,delay:2e4})})},a.declineOffer=function(a,e){b.deleteOffer(a,e).then(function(b){if(console.log(b),204===b.status){var e=a.username;h(a.message)?d.sendMessage(e,a.response):d.sendMessage(e,a.message),c.getAllUserPosts(f.userObj.user_settings.name)}else g.error({title:b.name,message:b.message,delay:2e4})},function(a){g.error({title:"Contact Support",message:"Failed to decline the offer.  Error:"+a,delay:2e4})})}}]),htsApp.directive("ownerMeetingsMoreInfo",function(){return{restrict:"E",scope:{post:"="},templateUrl:"js/myPosts/meetings/partials/myPosts.meetings.html",controller:"myPosts.meetings.controller"}}),htsApp.factory("meetingsFactory",["$http","$rootScope","$q","ENV","Session",function(a,b,c,d,e){var f={};return f.newOfferNotification=function(a){console.log("%s placed an %s offers on postingId %s to meet @ %s around %s",a.username,a.proposedTimes.length,a.postingId,a.proposedTimes[0].where,a.proposedTimes[0].when),console.log(a)},f.sendOffer=function(b,e){console.log("sending this offer",e);var f=c.defer();return a({method:"POST",url:d.postingAPI+b.postingId+"/offers",data:e}).then(function(c,e,g,h){console.log("heres our offer response",c);var i={post:b,offer:c.data};a.post(d.htsAppUrl+"/email/meeting-proposed/instant-reminder",{proposedMeeting:i}).success(function(a){}).error(function(a){}),f.resolve(c)},function(a,b,c,d){f.reject(a)}),f.promise},f.acceptOffer=function(b,e){var f=c.defer();console.log("HERES THE ACCEPTED OFFER",b),console.log("HEREs THE ACCEPTED POST",e);var g={post:e,offer:b};return a({method:"POST",url:d.postingAPI+b.postingId+"/offers/"+b.offerId+"/accept",data:b.response}).then(function(b,c,e,h){a.post(d.htsAppUrl+"/email/meeting-accepted/instant-reminder",{acceptedMeeting:g}).success(function(a){}).error(function(a){}),f.resolve(b)},function(a,b,c,d){f.reject(a)}),f.promise},f.deleteOffer=function(b,e){console.log("Deleting offer",e.postingId,b.offerId);var f=c.defer();return a({method:"DELETE",url:d.postingAPI+e.postingId+"/offers/"+b.offerId}).then(function(a,b,c,d){f.resolve(a)},function(a,b,c,d){f.reject(a)}),f.promise},f}]),htsApp.controller("myPosts.questions.controller",["$scope","qaFactory","$state","Notification","myPostsFactory","Session",function(a,b,c,d,e,f){a.userObj=f.userObj,a.toggled=function(a){console.log("Dropdown is now: ",a)},a.submitAnswer=function(c,f){var g={username:c.username,value:c.givenAnswer};b.submitAnswer(c.postingId,c.questionId,g).then(function(b){201===b.status?(console.log(b),e.getAllUserPosts(a.userObj.user_settings.name).then(function(a){})):d.error({title:b.name,message:b.message})},function(a){})},a.deleteQuestion=function(e,f,g){b.deleteQuestion(e,f).then(function(b){204===b.status?a.post.questions.results.length||c.go("^"):d.error({title:b.name,message:b.message})},function(a){})},a.updateAnswer=function(b){a.deleteAnswer(b),a.submitAnswer()},a.deleteAnswer=function(c){var d=a.question.postingId,e=a.question.questionId;b.deleteAnswer(d,e,c).then(function(a){},function(a){})}}]),htsApp.directive("ownerQuestionsMoreInfo",function(){return{restrict:"E",scope:{post:"="},templateUrl:"js/myPosts/questions/partials/myPosts.questions.html",controller:"myPosts.questions.controller"}}),htsApp.factory("qaFactory",["$http","$rootScope","ENV","$q","utilsFactory",function(a,b,c,d,e){var f={};return f.questions={store:[]},f.getPostingIdQuestions=function(b){var g=d.defer(),h={postingId:b,questions:!0,count:100};return a({method:"GET",url:c.postingAPI+b+e.bracketNotationURL(h)}).then(function(a,b,c,d){200===a.status?(f.questions.store=a.data.questions.results,g.resolve(a)):g.reject(a)},function(a,b,c,d){g.reject(a)}),g.promise},f.submitQuestion=function(b,e,g){var h=d.defer(),i=e.postingId,j={username:g,value:b};return a({method:"POST",url:c.postingAPI+i+"/questions",data:j}).then(function(b,d,g,i){if(201===b.status){f.questions.store.unshift(b.data),console.log("question response",b.data);var j={question:b.data,post:e};a.post(c.htsAppUrl+"/email/question-asked/instant-reminder",{questionAsked:j}).success(function(a){}).error(function(a){}),h.resolve(b)}else h.reject(b)},function(a,b,c,d){h.reject(a)}),h.promise},f.submitAnswer=function(b,e,f){var g=d.defer();return a({method:"POST",url:c.postingAPI+b+"/questions/"+e+"/answers",data:f}).then(function(a,b,c,d){g.resolve(a)},function(a,b,c,d){g.reject(a)}),g.promise},f.deleteQuestion=function(b,e){var f=d.defer();return a({method:"DELETE",url:c.postingAPI+b+"/questions/"+e}).then(function(a,b,c,d){f.resolve(a)},function(a,b,c,d){f.reject(a)}),f.promise},f.deleteAnswer=function(b,e,g){var h=d.defer();return a({method:"DELETE",url:c.postingAPI+b+"/questions/"+e+"/answers/ "+g}).then(function(a,c,d,e){f.getPostingIdQuestions(b).then(function(a){h.resolve(a)},function(a){h.reject(a)})},function(a,b,c,d){h.reject(a)}),h.promise},f}]),htsApp.controller("newPostController",["$scope","$modal","$state","newPostFactory","Session","authModalFactory",function(a,b,c,d,e,f){a.userObj=e.userObj,a.newPost=function(){if(a.userObj.user_settings.loggedIn){var e=b.open({templateUrl:"/js/newPost/modals/newPost/partials/newPost.html",controller:"newPostModal",size:"lg",keyboard:!1,backdrop:"static",resolve:{mentionsFactory:function(){return d}}});e.result.then(function(a){},function(b){"stageOneSuccess"===b.reason&&a.pushtoExternalService(b.post),console.log("Modal dismissed at: "+new Date)})}else c.go("signup")},a.pushtoExternalService=function(c){var d=b.open({templateUrl:"/js/newPost/modals/pushToExternalSources/partials/newPost.pushToExternalSources.html",controller:"pushNewPostToExternalSources",resolve:{newPost:function(){return c}}});d.result.then(function(a){},function(b){"stageTwoSuccess"===b.reason&&a.congrats(b),console.log("Modal dismissed at: "+new Date)})},a.congrats=function(a){var c=b.open({templateUrl:"/js/newPost/modals/congrats/partials/newPost.congrats.html",controller:"newPostCongrats",resolve:{newPost:function(){return a}}});c.result.then(function(){},function(a){"dismiss"===a&&console.log("Modal dismissed at: "+new Date)})}}]),htsApp.controller("newPostCongrats",["$scope","$modal","$modalInstance","newPost","myPostsFactory","Session","socketio",function(a,b,c,d,e,f,g){a.newPost=d,console.log(d),e.getAllUserPosts(f.userObj.user_settings.name).then(function(){for(var a=0;a<e.userPosts.data.length;a++){var b=e.userPosts.data[a];g.joinPostingRoom(b.postingId,"postingOwner")}}),a.dismiss=function(a){c.dismiss(a)}}]),htsApp.controller("newPostModal",["$scope","$http","$q","$modalInstance","$timeout","$state","$modal","mentionsFactory","$templateCache","ENV","Session","Notification",function(a,b,c,d,e,f,g,h,i,j,k,l){a.clearDemo=function(){console.log("clearing contents"),a.demoCleared||(document.getElementById("htsPost").innerHTML="",a.demoCleared=!0)},a.manualCategorySelect=h.manualCategorySelect,a.resetAll=function(){a.jsonObj=h.setJsonTemplate()},a.resetAll(),a.allCategories=[{code:"AAAA",name:"animals",categories:[{code:"APET",name:"pets"},{code:"ASUP",name:"supplies"},{code:"AOTH",name:"other"}]},{code:"CCCC",name:"community",categories:[{code:"CCNW",name:"classes and workshops"},{code:"COMM",name:"events"},{code:"CGRP",name:"groups"},{code:"CLNF",name:"lost and found"},{code:"CRID",name:"rideshares"},{code:"CVOL",name:"volunteers"},{code:"COTH",name:"other"}]},{code:"SSSS",name:"for sale",categories:[{code:"SANT",name:"antiques"},{code:"SAPP",name:"apparel"},{code:"SAPL",name:"appliances"},{code:"SANC",name:"art and crafts"},{code:"SKID",name:"babies and kids"},{code:"SBAR",name:"barters"},{code:"SBIK",name:"bicycles"},{code:"SBIZ",name:"businesses"},{code:"SCOL",name:"collections"},{code:"SEDU",name:"educational"},{code:"SELE",name:"electronics and photo"},{code:"SFNB",name:"food and beverage"},{code:"SFUR",name:"furniture"},{code:"SGAR",name:"garage sales"},{code:"SGFT",name:"gift cards"},{code:"SHNB",name:"health and beauty"},{code:"SHNG",name:"home and garden"},{code:"SIND",name:"industrial"},{code:"SJWL",name:"jewelry"},{code:"SLIT",name:"literature"},{code:"SMNM",name:"movies and music"},{code:"SMUS",name:"musical instruments"},{code:"SRES",name:"restaurants"},{code:"SSNF",name:"sports and fitness"},{code:"STIX",name:"tickets"},{code:"STOO",name:"tools"},{code:"STOY",name:"toys and hobbies"},{code:"STVL",name:"travel"},{code:"SWNT",name:"wanted"},{code:"SOTH",name:"other"}]},{code:"RRRR",name:"real estate",categories:[{code:"RCRE",name:"commercial real estate"},{code:"RHFR",name:"housing for rent"},{code:"RHFS",name:"housing for sale"},{code:"RSUB",name:"housing sublets"},{code:"RSWP",name:"housing swaps"},{code:"RLOT",name:"lots and land"},{code:"RPNS",name:"parking and storage"},{code:"RSHR",name:"room shares"},{code:"RVAC",name:"vacation properties"},{code:"RWNT",name:"want housing"},{code:"ROTH",name:"other"}]},{code:"SVCS",name:"services",categories:[{code:"SVCC",name:"creative"},{code:"SVCE",name:"education"},{code:"SVCF",name:"financial"},{code:"SVCM",name:"health"},{code:"SVCH",name:"household"},{code:"SVCP",name:"professional"},{code:"SVCO",name:"other"}]},{code:"ZZZZ",name:"uncategorized",categories:[{code:"ZOTH",name:"other"}]},{code:"VVVV",name:"vehicles",categories:[{code:"VAUT",name:"autos"},{code:"VMOT",name:"motorcycles"},{code:"VMPT",name:"motorcycle parts"},{code:"VPAR",name:"parts"},{code:"VOTH",name:"other"}]},{code:"JJJJ",name:"jobs",categories:[{code:"JACC",name:"accounting"},{code:"JADM",name:"administrative"},{code:"JAER",name:"aerospace and defense"},{code:"JANL",name:"analyst"},{code:"JANA",name:"animals and agriculture"},{code:"JARC",name:"architecture"},{code:"JART",name:"art"},{code:"JAUT",name:"automobile"},{code:"JBEA",name:"beauty"},{code:"JBIZ",name:"business development"},{code:"JWEB",name:"computer and web"},{code:"JCST",name:"construction and facilities"},{code:"JCON",name:"consulting"},{code:"JCUS",name:"customer service"},{code:"JDES",name:"design"},{code:"JEDU",name:"education"},{code:"JENE",name:"energy"},{code:"JENG",name:"engineering"},{code:"JENT",name:"entertainment and media"},{code:"JEVE",name:"events"},{code:"JFIN",name:"finance"},{code:"JFNB",name:"food and beverage"},{code:"JGIG",name:"gigs"},{code:"JGOV",name:"government"},{code:"JHEA",name:"healthcare"},{code:"JHOS",name:"hospitality and travel"},{code:"JHUM",name:"human resources"},{code:"JMNT",name:"installation, maintenance and repair"},{code:"JINS",name:"insurance"},{code:"JINT",name:"international"},{code:"JLAW",name:"law enforcement"},{code:"JLEG",name:"legal"},{code:"JMAN",name:"management and directorship"},{code:"JMFT",name:"manufacturing and mechanical"},{code:"JMAR",name:"marketing, advertising and public relations"},{code:"JNON",name:"non-profit"},{code:"JOPS",name:"operations and logistics"},{code:"JPHA",name:"pharmaceutical"},{code:"JPRO",name:"product, project and program management"},{code:"JPUR",name:"purchasing"},{code:"JQUA",name:"quality assurance"},{code:"JREA",name:"real estate"},{code:"JREC",name:"recreation"},{code:"JRES",name:"resumes"},{code:"JRNW",name:"retail and wholesale"},{code:"JSAL",name:"sales"},{code:"JSCI",name:"science"},{code:"JSEC",name:"security"},{code:"JSKL",name:"skilled trade and general labor"},{code:"JTEL",name:"telecommunications"},{code:"JTRA",name:"transportation"},{code:"JVOL",name:"volunteer"},{code:"JWNP",name:"writing and publishing"},{code:"JOTH",name:"other"}]}],a.macros={obo:"*Or Best Offer*"},a.isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},a.dismiss=function(b){a.resetAll(),d.dismiss(b)},d.opened.then(function(){console.log(a),a.dropzoneConfig={options:{paramName:"file",maxFilesize:15,maxFiles:10,thumbnailWidth:48,thumbnailHeight:48,previewTemplate:i.get("dropzone-thumbnail.html"),acceptedFiles:".jpeg,.jpg,.png,.gif",url:"/upload",autoProcessQueue:!1,uploadMultiple:!0,parallelUploads:10,clickable:"#imageUpload",previewsContainer:"#imgPreviewsContainer",dictDefaultMessage:""},eventHandlers:{sendingmultiple:function(a,b,c){console.log("sending for upload!")},successmultiple:function(b,c){console.log("what is this!",c);var d=a.jsonObj;d.images=c.images,a.publishPost()},addedfile:function(){console.log("image added"),a.numImages?(a.numImages=a.numImages+1,a.$apply(a.numImages)):(a.numImages=1,a.$apply(a.numImages))},removedfile:function(){console.log("image removed"),a.numImages=a.numImages-1,scope.$apply(a.numImages)},uploadprogress:function(a){},totaluploadprogress:function(b){a.uploadProgress=b,a.$apply(a.uploadProgress),100>b?(a.uploadMessage=Math.round(b)+"%",a.$apply(a.uploadProgress)):100===b&&(a.uploadMessage="Preparing photos.. please wait.",a.$apply(a.uploadProgress))}},init:{}}}),a.closeAlert=function(b){a.alerts.splice(b,1)},a.validatePost=function(){a.alerts=[];var b=a.jsonObj;b.hashtags.length?b.category?a.isEmpty(b.location)?a.alerts.push({type:"danger",msg:"Use the @ symbol in your post to specify where the buyer should pickup the item."}):a.processPost():(a.alerts.push({type:"danger",msg:"Add more #'s to describe your item for sale, or manually specify a category."}),a.jsonObj.category_name="other",a.jsonObj.category="ZOTH"):a.alerts.push({type:"danger",msg:"Use the # symbol in your post to describe the item you're selling.  Hint: You can add more than one hashtag if you want."})},a.processPost=function(){k.userObj.user_settings.loggedIn?a.numImages?a.dropzoneConfig.init():a.publishPost():f.go("signup")},a.cleanModel=function(a,b){h.cleanModel(a,b)},a.publishPost=function(){var c=a.jsonObj;c.username=k.userObj.user_settings.name,c.heading="";for(var e=0;e<c.hashtags.length;e++)e!==c.hashtags.length-1?c.heading+=c.hashtags[e]+" ":c.heading+=c.hashtags[e],c.hashtags[e]=c.hashtags[e];b.post(j.postingAPI,c).success(function(c){console.log("-----Post Complete----"),console.log(c),d.dismiss({reason:"stageOneSuccess",post:c}),b.post(j.precacheAPI,{posting:c}).success(function(a){console.log("precache success",a)}).error(function(a){console.log("precache error:",a)}),a.resetAll()}).error(function(a,b,c,d){console.log(a),l.error({title:a.name,message:a.message,delay:1e4})})},a.searchProducts=function(b){b&&h.predictProduct(b).then(function(b){a.products=b})},a.getProductTextRaw=function(a){return h.getProductMetaData(a).then(function(a){},function(a){console.log(a)}),'<span class="mention-highlighter" contentEditable="false">#'+a.value+"</span>"},a.map=h.googleMap,a.searchPlaces=function(b){b&&a.isEmpty(a.jsonObj.location)&&h.predictPlace(b).then(function(b){a.places=b});

},a.getPlacesTextRaw=function(a){return h.getPlaceMetaData(a).then(function(a){console.log(a)}),'<span class="mention-highlighter-location" contentEditable="false">@'+a.description+"</span>"},a.searchPrice=function(b){b&&a.isEmpty(a.jsonObj.price)&&(a.prices=h.predictPrice(b))},a.getPricesTextRaw=function(a){return h.getPriceMetaData(a),'<span class="mention-highlighter-price" contentEditable="false">$'+a.suggestion+"</span>"},function(){e(function(){a.demoCleared||$(".mention-highlighter").triggerHandler("show"),e(function(){a.demoCleared||($(".mention-highlighter").triggerHandler("hide"),$(".mention-highlighter-price").triggerHandler("show")),e(function(){a.demoCleared||($(".mention-highlighter-price").triggerHandler("hide"),$(".mention-highlighter-location").triggerHandler("show")),e(function(){a.demoCleared||($(".mention-highlighter-location").triggerHandler("hide"),$(".sellModalButton").triggerHandler("show")),e(function(){$(".sellModalButton").triggerHandler("hide")},4e3)},4e3)},4e3)},4e3)},1e3)}()}]),htsApp.factory("newPostFactory",["$q","$http","$timeout","ENV","utilsFactory","Notification",function(a,b,c,d,e,f){var g={},h=document.createElement("DIV");return g.defaultJson={annotations:[],category:null,category_name:null,category_group:null,category_group_name:null,body:null,images:[],location:{},hashtags:[],price:null,price_avg:null,price_type:null,source:"HSHTG"},g.setJsonTemplate=function(){return g.jsonTemplate=angular.copy(g.defaultJson),g.jsonTemplate},g.annotationsDictionary=new Hashtable,g.annotationsDictionary.put("year","Year"),g.annotationsDictionary.put("condition","Condition"),g.annotationsDictionary.put("make","Make"),g.annotationsDictionary.put("title_status","Title"),g.annotationsDictionary.put("model","Model"),g.annotationsDictionary.put("mileage","Mileage"),g.annotationsDictionary.put("transmission","Transmission"),g.annotationsDictionary.put("drive","Drive"),g.annotationsDictionary.put("paint_color","Paint"),g.annotationsDictionary.put("type","Type"),g.annotationsDictionary.put("fuel","Fuel"),g.annotationsDictionary.put("size","Size"),g.annotationsDictionary.put("bathrooms","Bath"),g.annotationsDictionary.put("no_smoking","Smoking"),g.annotationsDictionary.put("bedrooms","Rooms"),g.annotationsDictionary.put("dogs","Dogs"),g.annotationsDictionary.put("cats","Cats"),g.annotationsDictionary.put("attached_garage","Garage"),g.annotationsDictionary.put("laundry_on_site","Laundry"),g.annotationsDictionary.put("sqft","Sq Ft"),g.annotationsDictionary.put("size_dimensions","Dimensions"),g.annotationsDictionary.put("body_type","Body Type"),g.annotationsDictionary.put("drive_type","Drive Type"),g.annotationsDictionary.put("engine","Engine"),g.annotationsDictionary.put("exterior_color","Exterior Color"),g.annotationsDictionary.put("for_sale_by","Seller Type"),g.annotationsDictionary.put("interior_color","Interior Color"),g.annotationsDictionary.put("fuel_type","Fuel Type"),g.annotationsDictionary.put("listing_type","Listing Type"),g.annotationsDictionary.put("number_of_cylinders","Cylinders"),g.annotationsDictionary.put("options","Options"),g.annotationsDictionary.put("power_options","Power Options"),g.annotationsDictionary.put("safety_features","Safety"),g.annotationsDictionary.put("ship_to_location","Ship To"),g.annotationsDictionary.put("trim","Trim"),g.annotationsDictionary.put("vehicle_title","Title"),g.annotationsDictionary.put("vin","Vin"),g.annotationsDictionary.put("warranty","Warranty"),g.annotationsDictionary.put("bodyStyle","Body Type"),g.annotationsDictionary.put("drivetrain","Drive Train"),g.annotationsDictionary.put("exteriorColor","Exterior Color"),g.annotationsDictionary.put("interiorColor","Interior Color"),g.annotationsDictionary.put("Color","Color"),g.annotationsDictionary.put("Brand","Brand"),g.annotationsDictionary.put("Material Type","Material Type"),g.annotationsDictionary.put("Model","Model"),g.annotationsDictionary.put("Warranty","Warranty"),g.annotationsDictionary.put("CPU Speed","Processor Speed"),g.annotationsDictionary.put("CPU Type","Processor Type"),g.annotationsDictionary.put("Display Size","Screen Size"),g.annotationsDictionary.put("Operating System","OS Version"),g.annotationsDictionary.put("System Memory Size","Memory"),g.annotationsDictionary.put("Department","Department"),g.manualCategorySelect={code:null,show:!1,tooltip:"message",init:function(){this.code=g.jsonTemplate.category,g.getProductMetaData()}},g.predictProduct=function(c){var d=[],e={value:c},f=a.defer();return b.jsonp("//suggestqueries.google.com/complete/search?callback=?",{params:{client:"products-cc",hl:"en",jsonp:"JSON_CALLBACK",gs_rn:53,gs_ri:"products-cc",ds:"sh",cp:1,gs_id:9,q:c,xhr:"t"}}).success(function(a,b){a[1].length>0?(angular.forEach(a[1],function(a,b){h.innerHTML=a[0];var c=h.textContent||h.innerText||"";d.push({value:c})}),d[0].value!==e.value&&d.splice(0,0,e),d.length>7&&(d.length=7)):d.push(e),f.resolve(d)}),f.promise},g.getProductMetaData=function(b){var d=a.defer();if(b&&this.jsonTemplate.hashtags.push(b.value),this.jsonTemplate.hashtags.length){var e=this.jsonTemplate.hashtags.join(" ");g.getPopularCategory(e).then(function(a){g.jsonTemplate.category=a,g.getCategoryMetadata(a).then(function(a){g.manualCategorySelect.code=null,g.manualCategorySelect.show=!1,g.jsonTemplate.category_name=a.categories[0].name,g.jsonTemplate.category_group=a.code,g.jsonTemplate.category_group_name=a.name,g.getInternalAnnotations(e).then(function(a){g.getAmazonAnnotations(e,a).then(function(a){a.length?g.jsonTemplate.annotations=a:f.primary({title:"Hrmmmmm",message:"We didn't recognize that hashtag.  Add more hashtags to help us out."}),d.resolve(g.jsonTemplate)},function(a){f.error({title:"Ooops",message:"We seem to be having difficulty.  Don't worry, we've got our best geeks on the case."}),d.reject(a)})},function(a){f.error({title:"Ooops",message:"We seem to be having difficulty.  Don't worry, we've got our best geeks on the case."})})},function(a){f.error({title:"Cannot lookup cateogry metadata",message:a.message})})},function(){g.manualCategorySelect.tooltip="Add more hashtags to your post, or manually select the category",g.manualCategorySelect.show=!0,g.jsonTemplate.category="ZOTH",c(function(){$(".category-select").triggerHandler("show"),c(function(){$(".category-select").triggerHandler("hide")},4e3)},50),d.reject()})}else g.manualCategorySelect.show=!1,this.jsonTemplate.annotations=[],this.jsonTemplate.category=null,this.jsonTemplate.category_name=null,this.jsonTemplate.category_group=null,this.jsonTemplate.category_group_name=null,d.resolve(g.jsonTemplate);return d.promise},g.getPopularCategory=function(c){var e=a.defer();return g.manualCategorySelect.code?e.resolve(g.manualCategorySelect.code):b.get(d.groupingsAPI+"popular",{params:{query:c}}).success(function(a,b){var c=a;c.length?e.resolve(c[0].code):e.reject()}),e.promise},g.getCategoryMetadata=function(c){var e=a.defer();return b.get(d.groupingsAPI+c).success(function(a,b){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},g.getInternalAnnotations=function(c){var f=a.defer(),h=new Hashtable,i=0,j=0,k=0,l={start:0,count:500,filters:{mandatory:{contains:{heading:c}},optional:{exact:{categoryCode:[g.jsonTemplate.category,""]}}},geo:{coords:["-122.431297","37.773972"],min:0,max:1e5}},m=e.bracketNotationURL(l);return b({method:"GET",url:d.postingAPI+m}).success(function(a){console.log("ANNOTATION Query response: ",a);var b=[];if(a.results.length){for(var c=0;c<a.results.length;c++){var d=a.results[c];if(d.annotations){var e=d.annotations;for(var l in e)if(g.annotationsDictionary.containsKey(l))if(i++,h.containsKey(l)){var m=h.get(l),n=m+1;h.put(l,n)}else h.put(l,1)}d.askingPrice&&void 0!==d.askingPrice.value&&(j++,k=parseInt(k)+parseInt(d.askingPrice.value))}if(k>0&&(g.jsonTemplate.price_avg=k/j),h.size()>0){console.log("We have ",h.size(),"unique annotations in : ",i,"results");var o=Math.abs(i/h.size());console.log("Annotations should weigh more than: ",o),h.each(function(a){var c=Math.abs(h.get(a));console.log(a," has weight of",c),c>=o&&(b.push({key:g.annotationsDictionary.get(a),value:null}),console.log(c,">=",o))}),f.resolve(b)}else f.resolve(b)}else f.resolve(b)}),f.promise},g.getAmazonAnnotations=function(c,e){var f=a.defer();return b.get(d.annotationsAPI,{params:{query:c}}).success(function(a){if(console.log("Amazon data",a),a.length){for(var b=0;b<a.length;b++){var c=a[b],d=c.name;g.annotationsDictionary.containsKey(d)&&e.push({key:g.annotationsDictionary.get(d),value:null})}console.log("---------------------------"),console.log("done adding Amazon annotations!"),console.log("---------------------------"),f.resolve(e)}}).error(function(a){f.reject()}),f.promise},g.cleanModel=function(a,b){"#"===a?(console.log("HASHTAG TO REMOVE: ",b),this.jsonTemplate.hashtags=_.without(this.jsonTemplate.hashtags,b),console.log(this.jsonTemplate),g.getProductMetaData()):"$"===a?(console.log("PRICE TO REMOVE: ",b),this.jsonTemplate.price=null,this.jsonTemplate.price_avg=null,this.jsonTemplate.price_type=null,console.log(this.jsonTemplate)):"@"===a&&(console.log("LOCATION TO REMOVE: ",b),this.jsonTemplate.location={},console.log(this.jsonTemplate))},g.googleMap=new google.maps.Map(document.createElement("map-canvas")),g.predictPlace=function(b){var c=new google.maps.LatLngBounds(new google.maps.LatLng(37.79738,-122.52464),new google.maps.LatLng(37.68879,-122.36122)),d={input:b,bounds:c,componentRestrictions:{country:"US"}},e=new google.maps.places.AutocompleteService,f=a.defer();return e.getPlacePredictions(d,function(a,b){f.resolve(a)}),f.promise},g.getPlaceMetaData=function(c){var d=new google.maps.places.PlacesService(g.googleMap),e={placeId:c.place_id},f=a.defer(),h=null,i=null,k=null,l=null;return d.getDetails(e,function(a,d){if(d!=google.maps.places.PlacesServiceStatus.OK)return void console.log(d);a.description=c.description,console.log("here is our extra meta data"),console.log(a);var e={},m={};if(m.location={},a.formatted_address&&(e.formatted_address=a.formatted_address),a.geometry.location.lat()){e.lat=a.geometry.location.lat(),e["long"]=a.geometry.location.lng();var n=a.geometry.location.lat(),o=a.geometry.location.lng();m.coords=[o,n]}if(a.address_components){for(var p=0;p<a.address_components.length;++p)"administrative_area_level_1"==a.address_components[p].types[0]&&(i=a.address_components[p].short_name,e.state=i,m.location.state=i),"locality"==a.address_components[p].types[0]&&(h=a.address_components[p].long_name,e.short_name=h,m.location.city=h),"country"==a.address_components[p].types[0]&&(k=a.address_components[p].short_name,e.country=k,m.location.country=k),"postal_code"==a.address_components[p].types[0]&&(l=a.address_components[p].short_name,e.zipcode=l,m.location.postalCode=l);m.location.postalCode||b.get("/search/reversegeocode",{params:{lat:a.geometry.location.lat(),"long":a.geometry.location.lng()}}).success(function(a,b){for(console.log(a),j=0;j<a.results[0].address_components.length;j++){var c=a.results[0].address_components[j];if("postal_code"==c.types[0]){m.location.postalCode=c.long_name;break}}})}g.jsonTemplate.location=e,g.jsonTemplate.geo=m,f.resolve(g.jsonTemplate)}),f.promise},g.predictPrice=function(a){var b=[];return b.push({suggestion:a,rate:"flat_rate",value:a}),b.push({suggestion:a+"/hr",rate:"hourly",value:a}),b.push({suggestion:a+"/day",rate:"daily",value:a}),b.push({suggestion:a+"/week",rate:"weekly",value:a}),b.push({suggestion:a+"/month",rate:"monthly",value:a}),b.push({suggestion:a+"/year",rate:"yearly",value:a}),b},g.getPriceMetaData=function(a){this.jsonTemplate.price=a.value,this.jsonTemplate.price_type=a.rate},g}]),htsApp.controller("pushNewPostToExternalSources",["$scope","$modal","$modalInstance","$q","newPost","Notification","facebookFactory","ebayFactory","twitterFactory","subMerchantFactory",function(a,b,c,d,e,f,g,h,i,j){a.dismiss=function(b){a.publishToFacebook().then(function(){a.publishToTwitter().then(function(){a.publishToAmazon().then(function(){a.publishToEbay().then(function(){a.publishToCraigslist().then(function(){a.setupOnlinePayment().then(function(){c.dismiss({reason:b,post:e})})})})})})})},a.shareToggles={facebook:!1,twitter:!1,ebay:!1,amazon:!1,craigslist:!1},a.onlinePayment={allow:!1},a.publishToFacebook=function(){var b=d.defer();return a.shareToggles.facebook?g.publishToWall(e).then(function(a){e=a,f.primary({message:"Facebook publishing success!",delay:1e4}),b.resolve()},function(a){f.error({title:"Facebook publishing error",message:a.error.message,delay:1e4}),b.resolve()}):b.resolve(),b.promise},a.publishToTwitter=function(){var b=d.defer();return a.shareToggles.twitter?i.publishToTwitter(e).then(function(a){e=a,f.primary({message:"Twitter publishing success!",delay:1e4}),b.resolve()},function(a){f.error({title:"Twitter publishing error",message:a.error.message,delay:1e4}),b.resolve()}):b.resolve(),b.promise},a.publishToAmazon=function(){var b=d.defer();return a.shareToggles.amazon?(f.error({title:"Amazon publishing error",message:"push to amazon coming soon!",delay:1e4}),b.resolve()):b.resolve(),b.promise},a.publishToEbay=function(){var b=d.defer();return a.shareToggles.ebay?h.publishToEbay(e).then(function(a){e=a,f.primary({message:"Ebay publishing success!",delay:1e4}),b.resolve()},function(a){console.log("ebay err",a);try{f.error({title:"eBay "+a.name,message:a.sourceError.details[0].LongMessage[0],delay:1e4})}catch(c){f.error({title:"eBay "+a.name,message:a.message||"Please contact support",delay:1e4})}b.resolve()}):b.resolve(),b.promise},a.publishToCraigslist=function(){var b=d.defer();return a.shareToggles.craigslist?(f.error({title:"Craigslist publishing error",message:"push to craiglist coming soon!",delay:1e4}),b.resolve()):b.resolve(),b.promise},a.setupOnlinePayment=function(){var b=d.defer();return a.onlinePayment.allow?j.validateSubMerchant(e).then(function(a){console.log("success",a),b.resolve()},function(a){console.log("error",a),b.resolve()}):b.resolve(),b.promise}}]),htsApp.controller("notifications.controller",["$scope",function(a){function b(a){for(var b=[],c=0;a>c;c++)b.push({text:c,size:~~(100*Math.random()+50)});return b}a.items={collection:b(1e3)}}]),htsApp.controller("paymentController",["$scope","$http","$stateParams","ENV",function(a,b,c,d){!function(){var e=c.postingId,f=c.offerId;b.get(d.postingAPI+e,{params:{offers:!0}}).success(function(c){a.posting=c,b.get(d.htsAppUrl+"/getProfile",{params:{username:c.username}}).success(function(b){a.sellerProfile=b}).error(function(a){alert("could not lookup sellers profile.  please inform support")});for(var e,g=0;g<c.offers.results.length;g++){var h=c.offers.results[g];if(console.log(h.offerId+"==="+f),h.offerId===f){e=c.offers.results[g];break}}b.get(d.htsAppUrl+"/getProfile",{params:{username:e.username}}).success(function(b){a.buyerProfile=b}).error(function(a){alert("could not lookup buyers profile.  please inform support")})}).error(function(a){alert("We could not find your transaction. Please note the url you have been directed to and contact support.  Sorry for inconvenience.")})}(),a.dropinOptions={paymentMethodNonceReceived:function(e,f){e.preventDefault(),b.post(d.htsAppUrl+"/payments/purchase",{postingId:c.postingId,offerId:c.offerId,payment_method_nonce:f}).success(function(b){if(b.success)if(b.result.success)a.alerts.push({type:"success",msg:"Your payment has been sent!  Thanks for using HashtagSell!"});else{var d="/payment/"+c.postingId+"/"+c.offerId;a.alerts.push({type:"danger",msg:b.result.message+". <a href="+d+" target='_self'>Try Again?</a>"})}}).error(function(b){a.alerts.push({type:"danger",msg:b.message})})}},a.alerts=[]}]),htsApp.controller("peerReviewController",["$scope","$http","$stateParams","ENV",function(a,b,c,d){!function(){var e=(c.postingId,c.offerId,c.userId);a.reviewForm={rating:0,comment:null},b.get(d.htsAppUrl+"/getProfile",{params:{userId:e}}).success(function(b){a.reviewee=b,console.log("revieweeProfile profile",b)}).error(function(a){alert("could not lookup reviewees profile.  please inform support")})}(),a.alerts=[]}]),htsApp.controller("profile.controller",["$scope","profileFactory",function(a,b){a.nav=b.nav}]),htsApp.factory("profileFactory",["$http","$location","$q","ENV",function(a,b,c,d){var e={};return e.messages={"private":{sent:[],received:[]}},e.nav=[{title:"Messages",link:"profile.messages",data:e.messages},{title:"Reviews",link:"profile.reviews",data:[]}],e.getUserProfile=function(d){var e=c.defer(),f=b.protocol()+"://"+b.host()+":"+b.port()+"/getprofile?username="+d;return a({method:"GET",url:f}).then(function(a,b,c,d){e.resolve(a)},function(a,b,c,d){e.reject(a)}),e.promise},e}]),htsApp.controller("results.controller",["$scope","$state","searchFactory","splashFactory","uiGmapGoogleMapApi","uiGmapIsReady",function(a,b,c,d,e,f){a.status=c.status,a.views=c.views,a.openSplash=function(a){d.result=a.result,b.go("results.splash",{id:a.result.postingId})};var g=function(b){c.paginate(b).then(function(d){200!==d.status?(c.status.pleaseWait=!1,c.status.loading=!1,c.status.error.message=":( Oops.. Something went wrong.",c.status.error.trace=d.data.error):200===d.status&&(d.data.results.length?(a.results?c.filterArray(a.views,"pagination"):(c.filterArray(a.views,"pagination"),a.infiniteScroll=function(d,e){console.log("startIndex: "+d,"endIndex: "+e,"numRows: "+a.results.gridRows.length),!c.status.loading&&e>=a.results.gridRows.length-3&&(console.log("paginating"),c.status.loadingMessage="Fetching more awesome...",c.status.loading=!0,b+=1,g(b))}),a.results=c.results,c.status.pleaseWait=!1,c.status.loading=!1):d.data.results.length||0!==b?!d.data.results.length&&b>0&&(c.status.pleaseWait=!1,c.status.loadingMessage="Congratulations!  You've finished the internet!"):(c.status.pleaseWait=!1,c.status.loading=!1,c.status.error.message="¯\\_(ツ)_/¯  Nothing found.  Keep your searches simple."))},function(a){c.status.pleaseWait=!1,c.status.loading=!1,c.status.error.message="(゜_゜) Oops.. Something went wrong.",c.status.error.trace=a.data.error})};g(0),e.then(function(b){a.map=c.map})}]),htsApp.directive("onVsIndexChange",["$parse",function(a){return function(b,c,d){var e=a(d.onVsIndexChange),f=function(){e(b)};b.$watch("startIndex",f),b.$watch("endIndex",f)}}]),htsApp.directive("resizeGrid",["$rootScope","$window","searchFactory",function(a,b,c){return{restrict:"A",link:function(a,d){c.getInnerContainerDimensions=function(){return{w:d.width(),h:d.height()}},angular.element(b).bind("resize",function(){a.views.gridView&&c.filterArray(a.views,"resize"),a.$apply()})}}}]),htsApp.factory("searchFactory",["$http","$stateParams","$location","$q","$log","$timeout","utilsFactory","ENV",function(a,b,c,d,e,f,g,h){var j={};j.results={gridRows:[],unfiltered:[]},j.filter={mustHaveImage:!1,mustHavePrice:!1},j.sort={distance:!0,price:!1,datePosted:!1},j.priceSlider={min:0,max:0,step:1,rangeValue:[0,0],userSetValue:!1},j.views={gridView:!0,showMap:!1},j.status={pleaseWait:!0,error:{}},j.getInnerContainerDimensions=function(){return"function re-defined via resizeGrid directive"},j.paginate=function(a){var c=d.defer();return 0===a?j.getPopularCategories().then(function(a){if(200===a.status&&a.data.length){for(var b=[],c=0,d=0;d<a.data.length;d++){var e=a.data[d];c+=e.count}var f=c/a.data.length;console.log("total: ",c," divided by number of categories: ",a.data.length," equals: ",f);for(var g=0;g<a.data.length;g++){var h=a.data[g];console.log("total number of items: ",c),console.log("number of items in category: ",h.code," is: ",h.count);var i=h.count/c*100;console.log("Percentage weight for category: ",h.code," is: ",i),i>=10&&b.push(h.code)}b.length>1?j.defaultParams.filters.optional={exact:{categoryCode:b.join(",")}}:1===b.length?j.defaultParams.filters.optional={exact:{categoryCode:[b[0],""]}}:!b.length&&a.data.length&&(j.defaultParams.filters.optional={exact:{categoryCode:[a.data[0].code,""]}})}}).then(function(){if(console.log(b),j.defaultParams.filters.mandatory.contains.heading=b.q,b.locationObj&&b.locationObj.geometry){j.defaultParams.geo.lookup=!1;var d=b.locationObj.geometry.location.lat(),e=b.locationObj.geometry.location.lng();j.defaultParams.geo.coords=[e,d]}j.query(a).then(function(a){c.resolve(a)})}):j.query(a).then(function(a){c.resolve(a)}),c.promise},j.getPopularCategories=function(){var c=d.defer();return a({method:"GET",url:h.groupingsAPI+"popular",params:{query:b.q}}).then(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise},j.query=function(b){var c=d.defer(),e=g.bracketNotationURL(j.defaultParams);return console.log("final URL",e),a({method:"GET",url:h.postingAPI+e}).then(function(a){a.data.results.length&&(j.defaultParams={start:(b+1)*a.data.options.count,count:a.data.options.count,filters:a.data.options.filters,geo:{coords:a.data.options.geo.coords,min:a.data.options.geo.min,max:a.data.options.geo.max},sort:{}},j.results.unfiltered=j.results.unfiltered.concat(a.data.results)),c.resolve(a)},function(a){c.reject(a)}),c.promise},j.defaultParams={start:0,count:35,filters:{mandatory:{contains:{heading:null}}},geo:{lookup:!0,min:0,max:1289e4}},j.map={bounds:{},center:{latitude:0,longitude:0},zoom:8,markers:[],options:{zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_TOP},panControl:!1,mapTypeControl:!1,maxZoom:22,minZoom:0,streetViewControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}},clusterOptions:{gridSize:35,maxZoom:22,minZoom:0,zoomOnClick:!0,averageCenter:!0,minimumClusterSize:1,styles:[{textColor:"white",fontFamily:"Open Sans, Helvetica, Arial, sans-serif",url:"https://static.hashtagsell.com/htsApp/map-elements/cluster1.png",height:35,width:35},{textColor:"white",fontFamily:"Open Sans, Helvetica, Arial, sans-serif",url:"https://static.hashtagsell.com/htsApp/map-elements/cluster2.png",height:35,width:35},{textColor:"white",fontFamily:"Open Sans, Helvetica, Arial, sans-serif",url:"https://static.hashtagsell.com/htsApp/map-elements/cluster2.png",height:35,width:35}]},refresh:!1},j.cachedColumnCalculation=null,j.generateRows=function(a,b,c){var d;if(c.gridView){var e=j.getInnerContainerDimensions(),f=290;d=Math.floor(e.w/f),j.results.gridPercentageWidth=100/d}else d=1;if(d!==j.cachedColumnCalculation||"filter"===b||"pagination"===b){j.cachedColumnCalculation=d,j.results.gridRows=[];for(var g=0;g<a.length;g++){var h;if(h=c.gridView?390:0===a[g].images.length?179:1===a[g].images.length?261:420,g%d===0){for(var i={rowHeight:h,rowContents:[]},k=0;d>k;k++)g+k<a.length&&(a[g+k].askingPrice.value&&j.updatePriceSlider(a[g+k].askingPrice.value),i.rowContents.push(a[g+k]));j.results.gridRows.push(i),g=g+k-1}}var l=j.priceSlider.max;100>l?j.priceSlider.step=1:l>100&&500>l?j.priceSlider.step=5:l>500&&2e3>l?j.priceSlider.step=10:l>2e3&&1e4>l?j.priceSlider.step=50:l>1e4&&(j.priceSlider.step=50),console.log("Grid Rows: ",j.results.gridRows)}},j.updatePriceSlider=function(a){parseInt(a)>parseInt(j.priceSlider.max)&&(j.priceSlider.max=parseInt(a),j.priceSlider.userSetValue||(j.priceSlider.rangeValue[1]=parseInt(a)))},j.markerMaker=function(a,b,c){var d={id:a.postingId,coords:{latitude:a.geo.coordinates[1],longitude:a.geo.coordinates[0]},title:a.heading,options:{visible:c}};j.views.showMap&&(j.map.markers[b]?j.map.markers[b].options.visible=c:j.map.markers[b]=d)},j.mustHaveImage=function(a,b){var c=Boolean(a.images.length);return j.markerMaker(a,b,c),c},j.mustHavePrice=function(a,b){var c=Boolean(a.askingPrice.value);return j.markerMaker(a,b,c),c},j.mustFitPriceRange=function(a,b){var c=Boolean(!a.askingPrice.value||a.askingPrice.value>=j.priceSlider.rangeValue[0]&&a.askingPrice.value<=j.priceSlider.rangeValue[1]);return j.markerMaker(a,b,c),c},j.mustHaveImageAndPrice=function(a,b){var c=Boolean(a.images.length&&a.askingPrice.value);return j.markerMaker(a,b,c),c},j.mustHaveImageAndMustFitPriceRange=function(a,b){var c=Boolean(a.images.length&&a.askingPrice.value>=j.priceSlider.rangeValue[0]&&a.askingPrice.value<=j.priceSlider.rangeValue[1]);return j.markerMaker(a,b,c),c},j.mustHavePriceAndMustFitPriceRange=function(a,b){var c=Boolean(a.askingPrice.value&&a.askingPrice.value>=j.priceSlider.rangeValue[0]&&a.askingPrice.value<=j.priceSlider.rangeValue[1]);return j.markerMaker(a,b,c),c},j.mustHavePriceAndMustHaveImageAndMustFitPriceRange=function(a,b){var c=Boolean(a.images.length&&a.askingPrice.value&&a.askingPrice.value>=j.priceSlider.rangeValue[0]&&a.askingPrice.value<=j.priceSlider.rangeValue[1]);return j.markerMaker(a,b,c),c},j.filterArray=function(a,b){var c,d=j.filter,e=j.priceSlider;if(d.mustHavePrice&&d.mustHaveImage&&e.userSetValue)c=j.results.unfiltered.filter(j.mustHavePriceAndMustHaveImageAndMustFitPriceRange),j.generateRows(c,b,a);else if(d.mustHaveImage&&e.userSetValue)c=j.results.unfiltered.filter(j.mustHaveImageAndMustFitPriceRange),j.generateRows(c,b,a);else if(d.mustHavePrice&&e.userSetValue)c=j.results.unfiltered.filter(j.mustHavePriceAndMustFitPriceRange),j.generateRows(c,b,a);else if(d.mustHaveImage&&d.mustHavePrice)c=j.results.unfiltered.filter(j.mustHaveImageAndPrice),j.generateRows(c,b,a);else if(d.mustHaveImage)c=j.results.unfiltered.filter(j.mustHaveImage),j.generateRows(c,b,a);else if(d.mustHavePrice)c=j.results.unfiltered.filter(j.mustHavePrice),j.generateRows(c,b,a);else if(e.userSetValue)c=j.results.unfiltered.filter(j.mustFitPriceRange),j.generateRows(c,b,a);else{for(i=0;i<j.results.unfiltered.length;i++)j.markerMaker(j.results.unfiltered[i],i,!0);j.generateRows(j.results.unfiltered,b,a)}j.views.showMap&&k()};var k=function(){j.map.refresh=!0,f(function(){j.map.refresh=!1},100)};return j.resetResultsView=function(){j.results.gridRows=[],j.results.unfiltered=[],j.priceSlider.min=0,j.priceSlider.max=0,j.priceSlider.step=1,j.priceSlider.rangeValue=[0,0],j.priceSlider.userSetValue=!1,j.filter.mustHaveImage=!1,j.filter.mustHavePrice=!1,j.views.gridView=!0,j.views.showMap=!1,j.map.markers=[],j.status.pleaseWait=!0,j.status.error={},j.defaultParams={start:0,count:35,filters:{mandatory:{contains:{heading:null}}},geo:{lookup:!0,min:0,max:1e5}}},j}]),htsApp.service("Session",["$window","$http","$q","$state",function(a,b,c,d){return this.defaultUserObj={loggedIn:!1,profile_photo:"//static.hashtagsell.com/htsApp/placeholders/user-placeholder.png",banner_photo:"//static.hashtagsell.com/htsApp/placeholders/header-placeholder.png",safe_search:!0,email_provider:[{name:"Always Ask",value:"ask"}],favorites:[],feed_categories:[{name:"Real Estate",code:"RRRR"},{name:"For Sale",code:"SSSS"},{name:"Vehicles",code:"VVVV"}]},this.userObj={user_settings:JSON.parse(a.localStorage.getItem("hts_storage"))||this.defaultUserObj},this.updateServer=function(a){console.log("updating server");var d=c.defer();return b.post("/updateUserSettings",{userSettings:this.userObj.user_settings}).then(function(b){b.data.success?(d.resolve(),a&&a(b)):console.log(b)},function(a,b,c,e){d.reject()}),d.promise},this.create=function(b){console.log("Updating local storage with",b),b.user_settings.loggedIn=!0,this.userObj.user_settings=b.user_settings,console.log("data about to be written to local storage",this.userObj),a.localStorage.hts_storage=angular.toJson(this.userObj.user_settings)},this.destroy=function(){console.log("clearing user obj"),this.userObj.user_settings=this.defaultUserObj,console.log("Destroying HTML5 Session"),a.localStorage.removeItem("hts_storage"),d.go("feed")},this.getSessionValue=function(a){return this.userObj.user_settings[a]?this.userObj.user_settings[a]:this.userObj.user_settings.linkedAccounts[a]?this.userObj.user_settings.linkedAccounts[a]:!1},this.setSessionValue=function(a,b,c){console.log("set "+a+" in HTML5 user settings to ",b),this.userObj.user_settings[a]?this.userObj.user_settings[a]=b:this.userObj.user_settings.linkedAccounts[a]&&(this.userObj.user_settings.linkedAccounts[a]=b),this.create(this.userObj),this.updateServer(c)},this.getUserFromServer=function(){var a=c.defer();return b.get("/getUserSettings").then(function(b){var c={};c.user_settings=b.data,a.resolve(c)},function(b,c,d,e){a.reject()}),a.promise},this}]),htsApp.controller("settings.account.controller",["$scope","$timeout","$window","Session","ebayFactory","facebookFactory","twitterFactory","Notification",function(a,b,c,d,e,f,g,h){a.userObj=d.userObj,a.options={safeSearch:["On","Off"],defaultEmail:[{name:"Always Ask",value:"ask"},{name:"Gmail",value:"gmail"},{name:"Yahoo",value:"yahoo"},{name:"Hotmail",value:"hotmail"},{name:"AOL",value:"aol"},{name:"Use Default Mail Client",value:"mailto"}],location:["Approximate","Exact"]},a.defaultEmail=d.userObj.user_settings.email_provider[0].value,a.getSafeSearch=function(){return d.userObj.user_settings.safe_search?a.options.safeSearch[0]:a.options.safeSearch[1]},a.safeSearch=a.getSafeSearch(),a.setSafeSearch=function(c){"On"===c?d.setSessionValue("safe_search",!0,function(){a.safeSearchUpdated=!0,b(function(){a.safeSearchUpdated=!1},3e3)}):"Off"===c&&d.setSessionValue("safe_search",!1,function(){a.safeSearchUpdated=!0,b(function(){a.safeSearchUpdated=!1},3e3)})};var i=function(a){switch(a){case"ask":return[{name:"Always Ask",value:"ask"}];case"gmail":return[{name:"Gmail",value:"gmail"}];case"yahoo":return[{name:"Yahoo",value:"yahoo"}];case"hotmail":return[{name:"Hotmail",value:"hotmail"}];case"aol":return[{name:"AOL",value:"aol"}];case"mailto":return[{name:"Use Default Mail Client",value:"mailto"}]}};a.setDefaultEmail=function(c){c=i(c),d.setSessionValue("email_provider",c,function(){a.defaultEmailUpdated=!0,b(function(){a.defaultEmailUpdated=!1},3e3)})},a.getLocation=function(){switch(d.userObj.user_settings.location_type){case"Approximate":return a.options.location[0];case"Exact":return a.options.location[1]}},a.location=a.getLocation(),a.setLocation=function(c){d.setSessionValue("location_type",c,function(){a.locationUpdated=!0,b(function(){a.locationUpdated=!1},3e3)})},a.getEbaySessionID=function(){a.ebay={},e.getEbaySessionID().then(function(a){d.setSessionValue("ebay",a.data.ebay,function(){h.primary({message:"Successfully linked to eBay!",delay:1e4})})},function(b){a.ebay.sessionId=b.data.sessionId,a.ebay.err=b.data.ebay.Errors.LongMessage,h.error({title:"Manually link eBay account",message:"After completing eBay authorization please click the big red button below.",delay:1e4})})},a.getEbayToken=function(){e.manuallyGetEbayToken(a.ebay.sessionId).then(function(b){console.log(b),b.data.success?d.setSessionValue("ebay",b.data.ebay,function(){console.log("ebay account connected!")}):(a.ebay.sessionId=!1,a.ebay.err=b.data.ebay.Errors.LongMessage)})},a.disconnectFacebook=function(){f.disconnectFacebook()},a.disconnectTwitter=function(){g.disconnectTwitter()},a.disconnectEbay=function(){e.disconnectEbay()},a.disconnectAmazon=function(){d.setSessionValue("amazon",{},function(){console.log("amazon account disconnected!")})}}]),htsApp.controller("settings.password.controller",["$scope","authFactory",function(a,b){a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.updatePassword=function(c){if(c){var d=a.currentPassword,e=a.newPassword;b.updatePassword(d,e).then(function(b){b.error?a.alerts.push({type:"danger",msg:b.error}):b.success&&a.alerts.push({type:"success",msg:"Success! Password updated."})},function(){a.alerts.push({type:"danger",msg:"Whoops.. Try again or contact support."})})}a.currentPassword=null,a.newPassword=null,a.verifyNewPassword=null}}]),htsApp.controller("settings.payment.controller",["$scope",function(a){}]),htsApp.controller("settings.profile.controller",["$scope","Session","$templateCache",function(a,b,c){a.userObj=b.userObj,a.bindingObj={currentlyUploadingProfilePhoto:!1,currentlyUploadingBannerPhoto:!1,requireUpdate:!0},a.profileDropzoneConfig={options:{paramName:"profilePhoto",maxFilesize:10,acceptedFiles:".jpeg,.jpg,.png,.gif",url:"/upload",autoProcessQueue:!0,uploadMultiple:!1,addRemoveLinks:!1,thumbnailWidth:90,thumbnailHeight:90,previewsContainer:"#profilePreview",previewTemplate:c.get("profileUploadTemplate.tpl"),clickable:".triggerProfileImageUpload",
dictDefaultMessage:""},eventHandlers:{addedfile:function(){a.$apply(function(){a.bindingObj.currentlyUploadingProfilePhoto=!0})},success:function(c){var d=JSON.parse(c.xhr.response);console.log(d),b.setSessionValue("profile_photo",d.url,a.$apply(function(){a.bindingObj.currentlyUploadingProfilePhoto=!1}))},complete:function(){console.log("complete")}}},a.bannerDropzoneConfig={options:{paramName:"bannerPhoto",maxFilesize:10,acceptedFiles:".jpeg,.jpg,.png,.gif",url:"/upload",autoProcessQueue:!0,uploadMultiple:!1,addRemoveLinks:!1,thumbnailWidth:180,thumbnailHeight:120,previewsContainer:"#bannerPreview",previewTemplate:c.get("bannerUploadTemplate.tpl"),clickable:".triggerBannerImageUpload",dictDefaultMessage:""},eventHandlers:{addedfile:function(){a.$apply(function(){a.bindingObj.currentlyUploadingBannerPhoto=!0})},success:function(c){var d=JSON.parse(c.xhr.response);console.log(d),b.setSessionValue("banner_photo",d.url,a.$apply(function(){a.bindingObj.currentlyUploadingBannerPhoto=!1}))},complete:function(){console.log("complete")}}},a.requireUpdate=function(){a.bindingObj.requireUpdate=!1},a.submitUpdatedProfile=function(){b.setSessionValue("biography",a.userObj.user_settings.biography,function(){a.bindingObj.requireUpdate=!0})}}]),htsApp.controller("sideNav.controller",["$scope","sideNavFactory","splashFactory",function(a,b,c){a.sideNav=b,a.result=c.result}]),htsApp.factory("sideNavFactory",function(){var a={};return a.defaultMenu=[{name:"Feed",alerts:null,link:"feed",active:!1},{name:"My Posts",alerts:null,link:"myposts",active:!1},{name:"Watch List",alerts:null,link:"watchlist",active:!1},{name:"Notify Me",alerts:null,link:"notifications",active:!1}],a.items=a.defaultMenu,a.settingsMenu=[{name:"Back",alerts:null,link:null,active:!1},{name:"Account",alerts:null,link:"settings.account",active:!1},{name:"Password",alerts:null,link:"settings.password",active:!1},{name:"Profile",alerts:null,link:"settings.profile",active:!1},{name:"Payment & Shipping",alerts:null,link:"settings.payment",active:!1}],a.updateSideNav=function(b){switch(b.name){case"settings":a.settingsMenu[0].active=!1,a.settingsMenu[1].active=!1,a.settingsMenu[2].active=!1,a.settingsMenu[3].active=!1,a.settingsMenu[4].active=!1,a.items=a.settingsMenu;break;case"settings.account":a.settingsMenu[0].active=!1,a.settingsMenu[1].active=!0,a.settingsMenu[2].active=!1,a.settingsMenu[3].active=!1,a.settingsMenu[4].active=!1,a.items=a.settingsMenu;break;case"settings.password":a.settingsMenu[0].active=!1,a.settingsMenu[1].active=!1,a.settingsMenu[2].active=!0,a.settingsMenu[3].active=!1,a.settingsMenu[4].active=!1,a.items=a.settingsMenu;break;case"settings.profile":a.settingsMenu[0].active=!1,a.settingsMenu[1].active=!1,a.settingsMenu[2].active=!1,a.settingsMenu[3].active=!0,a.settingsMenu[4].active=!1,a.items=a.settingsMenu;break;case"settings.payment":a.settingsMenu[0].active=!1,a.settingsMenu[1].active=!1,a.settingsMenu[2].active=!1,a.settingsMenu[3].active=!1,a.settingsMenu[4].active=!0,a.items=a.settingsMenu;break;case"feed":a.defaultMenu[0].active=!0,a.defaultMenu[1].active=!1,a.defaultMenu[2].active=!1,a.defaultMenu[3].active=!1,a.items=a.defaultMenu;break;case"myposts":a.defaultMenu[0].active=!1,a.defaultMenu[1].active=!0,a.defaultMenu[2].active=!1,a.defaultMenu[3].active=!1,a.items=a.defaultMenu;break;case"watchlist":a.defaultMenu[0].active=!1,a.defaultMenu[1].active=!1,a.defaultMenu[2].active=!0,a.defaultMenu[3].active=!1,a.items=a.defaultMenu;break;case"notifications":a.defaultMenu[0].active=!1,a.defaultMenu[1].active=!1,a.defaultMenu[2].active=!1,a.defaultMenu[3].active=!0,a.items=a.defaultMenu;break;case"results":a.defaultMenu[0].active=!1,a.defaultMenu[1].active=!1,a.defaultMenu[2].active=!1,a.defaultMenu[3].active=!1,a.items=a.defaultMenu;break;case"profile":a.defaultMenu[0].active=!1,a.defaultMenu[1].active=!1,a.defaultMenu[2].active=!1,a.defaultMenu[3].active=!1,a.items=a.defaultMenu}},a.sideNav={hidden:!0,listView:!0},a}),htsApp.controller("sideProfile",["$scope","Session","$templateCache",function(a,b,c){a.userObj=b.userObj,a.checkDefaultBanner=function(){return"/images/userMenu/header-placeholder.png"===a.userObj.user_settings.banner_photo},a.checkDefaultProfilePhoto=function(){return"/images/userMenu/user-placeholder.png"===a.userObj.user_settings.profile_photo},a.profileDropzoneConfig={options:{paramName:"profilePhoto",maxFilesize:10,acceptedFiles:".jpeg,.jpg,.png,.gif",url:"/upload",autoProcessQueue:!0,uploadMultiple:!1,previewTemplate:'<div style="display:none"></div>',clickable:".sideNavTriggerProfileImageUpload",dictDefaultMessage:""},eventHandlers:{success:function(a){var c=JSON.parse(a.xhr.response);console.log(c),b.setSessionValue("profile_photo",c.url,function(){console.log("done sidenav profile photo upload")})},complete:function(){console.log("complete")}}},a.bannerDropzoneConfig={options:{paramName:"bannerPhoto",maxFilesize:10,acceptedFiles:".jpeg,.jpg,.png,.gif",url:"/upload",autoProcessQueue:!0,uploadMultiple:!1,previewTemplate:'<div style="display:none"></div>',clickable:".sideNavTriggerBannerImageUpload",dictDefaultMessage:""},eventHandlers:{success:function(c){var d=JSON.parse(c.xhr.response);console.log(d),b.setSessionValue("banner_photo",d.url,a.$apply(function(){console.log("done sidenav banner photo upload")}))},complete:function(){console.log("complete")}}}}]),htsApp.factory("socketio",["ENV","myPostsFactory","Notification","favesFactory",function(a,b,c,d){var e={postingSocket:io(a.realtimePostingAPI),userSocket:io(a.realtimeUserAPI),postings:[],usersViewing:[]};return e.joinPostingRoom=function(a,b,c){var d=0;"toggleSplash"===b?d=1:"inWatchList"===b?d=2:"postingOwner"===b&&(d=3);var f=!1;if(e.postings.length)for(var g=0;g<e.postings.length;g++){var h=e.postings[g];if(h.postingId===a){if(h.permissionLevel<d){e.postings.splice(g,1),f=!0,b=e.cachedUsername+" is joining posting room: "+a+" because requested permission level "+d+" is greater than "+h.permissionLevel;break}}else g===e.postings.length-1&&(f=!0,b=e.cachedUsername+" is joining posting room: "+a+" for first time with permission level "+d)}else f=!0,b=e.cachedUsername+" is joining posting room: "+a+" with permission level "+d+" as their first room ";f?(e.postings.push({postingId:a,permissionLevel:d}),e.postingSocket.emit("join-room",{username:e.cachedUsername,roomId:a})):b=e.cachedUsername+" already joined posting room: "+a+" with higher permission level than "+d,c&&c()},e.joinUserRoom=function(a,b,c){e.usersViewing.push(b),console.log(b+" is joining "+a+"'s room: "),e.userSocket.emit("join-room",{username:b,roomId:a}),c&&c()},e.closeAllConnections=function(a){e.leaveUserRoom(e.cachedUsername),e.cachedUsername=null,a&&a()},e.leavePostingRoom=function(a,b,c){var d=0;"toggleSplash"===b?d=1:"inWatchList"===b?d=2:"postingOwner"===b&&(d=3);var f=!1;if(e.postings.length)for(var g=0;g<e.postings.length;g++){var h=e.postings[g];if(h.postingId===a){if(h.permissionLevel<=d){e.postings.splice(g,1),f=!0,b=e.cachedUsername+" is leaving posting room: "+a+" because requested permission level "+d+" is greater than or equal to "+h.permissionLevel;break}b=e.cachedUsername+" is NOT leaving posting room: "+a+" because requested permission level "+d+" is less than "+h.permissionLevel}else g===e.postings.length-1&&(b=e.cachedUsername+" is requesting to leave posting room: "+a+" which they have not joined?")}else b=e.cachedUsername+" is requesting to leave posting room: "+a+" when they havent joined any rooms?";f&&e.postingSocket.emit("leave-room",a),c&&c()},e.leaveUserRoom=function(a,b){e.usersViewing.splice(e.usersViewing.indexOf(a),1),console.log("leaving user room: "+a),e.userSocket.emit("leave-room",a),b&&b()},e.sendMessage=function(a,b){e.userSocket.emit("private-message",{message:b,recipient:a,username:e.cachedUsername})},e.userSocket.on("private-message",function(a){console.log("emitted private message",a),c.primary({title:"New message from @"+a.username,message:a.message,delay:1e4})}),e.postingSocket.on("make-offer",function(a){console.log("emitted meeting request",a),a.username===e.cachedUsername?d.checkFave(a.posting,function(b){b?d.updateFavorite(a,function(){var b='"/watchlist/meetings/'+a.posting.postingId+'"';c.primary({title:"<a href="+b+">Meeting Request Sent!</a>",message:"<a href="+b+">This watchlist item has been updated. You'll be notified when the seller responds.</a>",delay:1e4})}):d.addFave(a.posting,function(){var b='"/watchlist/meetings/'+a.posting.postingId+'"';c.primary({title:"<a href="+b+">Meeting Request Sent!</a>",message:"<a href="+b+">This item has been added to your watchlist. You'll be notified when the seller responds.</a>",delay:1e4})})}):a.posting.username===e.cachedUsername?b.getAllUserPosts(e.cachedUsername).then(function(b){var d='"/myposts/meetings/'+a.posting.postingId+'"';c.primary({title:"<a href="+d+">New Meeting Request</a>",message:"<a href="+d+">@"+a.username+" would like to meet!</a>",delay:1e4})}):d.updateFavorite(a,function(){var b='"/wishlist/meetings/'+a.posting.postingId+'"';c.primary({title:"<a href="+b+">"+a.posting.heading+" may go fast!</a>",message:"<a href="+b+">Just letting you know other people are interested in an item you're watching. *wink *wink</a>",delay:1e4})}),console.log('%s would like to meet %s regarding postingId: "%s"',a.username,a.proposedTimes,a.posting.postingId)}),e.postingSocket.on("question",function(a){console.log("emitted question",a),a.username===e.cachedUsername?d.checkFave(a.posting,function(b){b?d.updateFavorite(a,function(){var b='"/watchlist/questions/'+a.posting.postingId+'"';c.primary({title:"<a href="+b+">Question Sent!</a>",message:"<a href="+b+">This watchlist item has been updated. You'll be notified when the seller responds.</a>",delay:1e4})}):d.addFave(a.posting,function(){var b='"/watchlist/questions/'+a.posting.postingId+'"';c.primary({title:"<a href="+b+">Question Sent!</a>",message:"<a href="+b+">This item has been added to your watchlist. You'll be notified when the seller responds.</a>",delay:1e4})})}):a.posting.username===e.cachedUsername?b.getAllUserPosts(e.cachedUsername).then(function(b){var d='"/myposts/questions/'+a.question.postingId+'"';c.primary({title:"<a href="+d+">New Question</a>",message:"<a href="+d+">"+a.question.value+"</a>",delay:1e4})}):d.updateFavorite(a,function(){console.log("silently updated watchlist")}),console.log('%s asked a question on postingId %s : "%s"',a.question.username,a.posting.postingId,a.question.value)}),e.postingSocket.on("answer",function(a){console.log("emitted answer",a),a.username===e.cachedUsername?d.updateFavorite(a,function(){var b='"/watchlist/questions/'+a.posting.postingId+'"';c.primary({title:"<a href="+b+">Question has been answered</a>",message:"<a href="+b+">"+a.answer.value+"</a>",delay:1e4})}):a.username!==a.posting.username&&d.updateFavorite(a,function(){}),console.log('%s answered a question on postingId %s : "%s"',a.posting.username,a.posting.postingId,a.answer.value)}),e.postingSocket.on("accept-offer",function(a){if(console.log("emitted meeting acceptance",a),a.username===e.cachedUsername){d.updateFavorite(a,function(){console.log("silently updated watchlist")});var b='"/watchlist/meetings/'+a.posting.postingId+'"';c.primary({title:"<a href="+b+">@"+a.posting.username+" accepted your meeting.</a>",message:"<a href="+b+">Congrats! Your meeting request has been accepted.  We'll send you a reminder email you way.</a>",delay:1e4})}console.log('%s accepted meeting request on postingId %s : "%s"',a.posting.username,a.posting.postingId,a.acceptedTime.when)}),e.postingSocket.on("decline-offer",function(a){a.username===e.cachedUsername?d.checkFave(a.posting,function(b){b&&d.updateFavorite(a,function(){var b='"/watchlist/meetings/'+a.posting.postingId+'"';c.primary({title:"<a href="+b+">Meeting Cancelled!</a>",message:"<a href="+b+">The seller has been notified</a>",delay:1e4})})}):a.posting.username===e.cachedUsername?b.getAllUserPosts(e.cachedUsername).then(function(b){var d='"/myposts/meetings/'+a.posting.postingId+'"';c.primary({title:"<a href="+d+">Meeting Cancelled</a>",message:"<a href="+d+">@"+a.username+" Had to cancel their meeting.  We apologize for the inconvenience</a>",delay:1e4})}):d.updateFavorite(a,function(){}),console.log('%s cancelled %s regarding postingId: "%s"',a.username,a.proposedTimes,a.posting.postingId)}),e.postingSocket.on("delete-question",function(a){a.username===e.cachedUsername?d.checkFave(a.posting,function(b){b&&d.updateFavorite(a,function(){})}):a.posting.username===e.cachedUsername?b.getAllUserPosts(e.cachedUsername).then(function(a){}):d.updateFavorite(a,function(){console.log("silently updated watchlist")})}),e.userSocket.on("reconnect",e.init),e.postingSocket.on("reconnect",e.init),e.init=function(a){if(a){e.cachedUsername=a;var b=a,c=a;e.joinUserRoom(b,c)}},e}]),htsApp.controller("splashController",["$scope","$modal","$state","splashFactory","metaFactory",function(a,b,c,d,e){var f=angular.copy(e.metatags);console.log(f);var g=["$scope","$filter","sideNavFactory","uiGmapGoogleMapApi","favesFactory","qaFactory","transactionFactory","Session","socketio",function(a,b,f,g,h,i,j,k,l){function m(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText||""}if(a.userObj=k.userObj,a.result=d.result,console.log(a.result),a.result.heading&&(e.metatags.page.title=a.result.heading,e.metatags.facebook.title=a.result.heading,e.metatags.twitter.title=a.result.heading),a.result.body){var n=m(a.result.body);e.metatags.page.description=n,e.metatags.facebook.description=n,e.metatags.twitter.description=n}a.result.images.length&&(e.metatags.facebook.image=a.result.images[0].full||a.result.images[0].thumb||a.result.images[0].images,e.metatags.twitter.image=a.result.images[0].full||a.result.images[0].thumb||a.result.images[0].images),a.toggles={showCarousel:!0},g.then(function(b){a.map={settings:{center:{latitude:a.result.geo.coordinates[1],longitude:a.result.geo.coordinates[0]},options:{zoomControl:!1,panControl:!1,mapTypeControl:!1},zoom:14},marker:{id:0,coords:{latitude:a.result.geo.coordinates[1],longitude:a.result.geo.coordinates[0]}}}}),a.windowOptions={content:"please wait",disableAutoPan:!1},a.infoWindow={show:!1},a.onClick=function(){a.$apply(function(){a.infoWindow.show=!a.infoWindow.show})},a.closeClick=function(){a.infoWindow.show=!1},a.userObj.user_settings.loggedIn&&h.checkFave(a.result,function(b){a.favorited=b}),a.toggleFave=function(b){a.userObj.user_settings.loggedIn?a.favorited?h.removeFave(b,function(){a.favorited=!1,l.leavePostingRoom(b.postingId,"inWatchList")}):h.addFave(b,function(){a.favorited=!0,l.joinPostingRoom(b.postingId,"inWatchList")}):c.go("betaChecker")},a.result.external.threeTaps.location.formatted?a.windowOptions.content=a.result.external.threeTaps.location.formatted:!function(){var b=new google.maps.Geocoder,c=new google.maps.LatLng(a.result.geo.coordinates[0],a.result.geo.coordinates[1]);b.geocode({latLng:c},function(b,c){c===google.maps.GeocoderStatus.OK?b[1]&&(a.windowOptions.content=b[1].formatted_address):a.windowOptions.content="no address discovered"})}(),a.result.annotations&&(a.result.sanitized_annotations=d.sanitizeAnnotations(a.result.annotations)),a.sideNav=f.sideNav,a.toggleOffCanvasSideNav=function(){a.sideNav.hidden=!a.sideNav.hidden},a.questions=i.questions,a.getPostingIdQuestions=function(){i.getPostingIdQuestions(a.result.postingId).then(function(a){},function(a){console.log(a)})},a.qamodule={question:""},a.submitQuestion=function(b){var d=a.userObj.user_settings.loggedIn;if(d){var e=a.result,f=a.userObj.user_settings.name;l.joinPostingRoom(e.postingId,"inWatchList",function(){i.submitQuestion(b,e,f).then(function(b){console.log(b),a.qamodule.question=""},function(a){console.log(a)})})}else c.go("betaChecker")},a.emailSeller=function(a){j.quickCompose(a)},a.displayPhone=function(a){j.displayPhone(a)},a.placeOffer=function(a){j.placeOffer(a)},a.buyOnline=function(a){alert("online payment and shipping coming soon!")},a.placeBid=function(a){j.placeBid(a)},a.showOriginal=function(a){j.showOriginal(a)}}],h=function(){var d=b.open({backdrop:!1,templateUrl:"/js/splash/partials/splash_content.html",windowTemplateUrl:"js/splash/partials/splash_window.html",controller:g});d.result.then(function(a){},function(a){c.go("^")}),a.$on("$stateChangeStart",function(a,b,c,g,h){e.metatags.page=f.page,e.metatags.facebook=f.facebook,e.metatags.twitter=f.twitter,d.dismiss("direct")})};if(d.result)h();else{var i=c.params.id;d.lookupItemDetails(i).then(function(a){d.result=a.data,h()},function(a){console.log(a)})}}]),htsApp.directive("splashSideProfile",["splashFactory",function(a){return{restrict:"E",scope:{result:"="},link:function(b,c,d){if("HSHTG"===b.result.external.source.code){var e=b.result.username;a.getUserProfile(e).then(function(a){if(200!==a.status){var b=a.data.error;console.log(b)}else if(200===a.status){var d=a.data.user,e=angular.element(c[0].querySelector(".profile"));e.css({"background-image":"url("+d.banner_photo+")","background-size":"cover"});var f=angular.element(c[0].querySelector(".bs-profile-image"));f.css({"background-image":"url("+d.profile_photo+")","background-size":"cover"});var g=angular.element(c[0].querySelector(".splash-bs-username"));g.html("@"+d.name)}},function(a){console.log(a)})}else{var f=angular.element(c[0].querySelector(".profile"));if(b.result.images.length){var g=b.result.images.length-1,h=b.result.images[g].thumb||b.result.images[g].images||b.result.images[g].full;f.css({"background-image":"url("+h+")","background-size":"cover"})}else f.css({"background-image":"url(https://static.hashtagsell.com/htsApp/placeholders/header-placeholder.png)","background-size":"cover"});var i=angular.element(c[0].querySelector(".splash-bs-username")),j=angular.element(c[0].querySelector(".bs-profile-image"));"APSTD"===b.result.external.source.code?(j.css({"background-image":"url(https://static.hashtagsell.com/logos/marketplaces/apartments_com_splash.png)","background-size":"cover"}),i.html("@apartments.com")):"AUTOD"===b.result.external.source.code?(j.css({"background-image":"url(https://static.hashtagsell.com/logos/marketplaces/autotrader_splash.png)","background-size":"cover"}),i.html("@autotrader.com")):"BKPGE"===b.result.external.source.code?(j.css({"background-image":"url(https://static.hashtagsell.com/logos/marketplaces/backpage_splash.png)","background-size":"cover"}),i.html("@backpage.com")):"CRAIG"===b.result.external.source.code?(j.css({"background-image":"url(https://static.hashtagsell.com/logos/marketplaces/craigslist_splash.png)","background-size":"cover"}),i.html("@craigslist.com")):"EBAYM"===b.result.external.source.code?(j.css({"background-image":"url(https://static.hashtagsell.com/logos/marketplaces/ebay_motors_splash.png)","background-size":"cover"}),i.html("@ebaymotors.com")):"E_BAY"===b.result.external.source.code&&(j.css({"background-image":"url(https://static.hashtagsell.com/logos/marketplaces/ebay_splash.png)","background-size":"cover"}),i.html("@ebay.com"))}}}}]),htsApp.factory("splashFactory",["$http","$location","$q","ENV",function(a,b,c,d){var e=new Hashtable;e.put("source_neighborhood","Neighborhood"),e.put("year","Year"),e.put("condition","Condition"),e.put("make","Make"),e.put("title_status","Title"),e.put("model","Model"),e.put("mileage","Mileage"),e.put("transmission","Transmission"),e.put("drive","Drive"),e.put("paint_color","Paint"),e.put("type","Type"),e.put("fuel","Fuel"),e.put("size","Size"),e.put("bathrooms","Bath"),e.put("available","Available"),e.put("no_smoking","Smoking"),e.put("bedrooms","Rooms"),e.put("dogs","Dogs"),e.put("cats","Cats"),e.put("attached_garage","Garage"),e.put("laundry_on_site","Laundry"),e.put("sqft","Sq Ft"),e.put("size_dimensions","Dimensions"),e.put("body_type","Body Type"),e.put("drive_type","Drive Type"),e.put("engine","Engine"),e.put("exterior_color","Exterior Color"),e.put("for_sale_by","Seller Type"),e.put("interior_color","Interior Color"),e.put("fuel_type","Fuel Type"),e.put("listing_type","Listing Type"),e.put("number_of_cylinders","Cylinders"),e.put("options","Options"),e.put("power_options","Power Options"),e.put("safety_features","Safety"),e.put("ship_to_location","Ship To"),e.put("trim","Trim"),e.put("vehicle_title","Title"),e.put("vin","Vin"),e.put("warranty","Warranty"),e.put("bodyStyle","Body Type"),e.put("drivetrain","Drive Train"),e.put("exteriorColor","Exterior Color"),e.put("interiorColor","Interior Color"),e.put("seller","Seller Type"),e.put("Year","Year"),e.put("Color","Color"),e.put("Brand","Brand"),e.put("Material Type","Material Type"),e.put("Model","Model"),e.put("Warranty","Warranty"),e.put("CPU Speed","Processor Speed"),e.put("CPU Type","Processor Type"),e.put("Display Size","Screen Size"),e.put("Operating System","OS Version"),e.put("System Memory Size","Memory"),e.put("Department","Department");var f={};return f.sanitizeAnnotations=function(a){var b={};return angular.forEach(a,function(a,c){if("string"==typeof c){console.log("we are om jere");var d=e.get(c);d&&(b[d]=a)}else{console.log("hashtag annotaion",a);var f=a;if(f.value){var g=e.get(f.key);g&&(b[g]=f.value)}}}),b},f.getUserProfile=function(d){var e=c.defer(),f=b.protocol()+"://"+b.host()+":"+b.port()+"/getprofile?username="+d;return a({method:"GET",url:f}).then(function(a,b,c,d){e.resolve(a)},function(a,b,c,d){e.reject(a)}),e.promise},f.lookupItemDetails=function(b){var e=c.defer();return a({method:"GET",url:d.postingAPI+b}).then(function(a,b,c,d){e.resolve(a)},function(a,b,c,d){e.reject(a)}),e.promise},f}]),htsApp.factory("subMerchantFactory",["$q","$http","$modal","$log","ENV","Session",function(a,b,c,d,e,f){var g={};return g.validateSubMerchant=function(b){var e=a.defer(),g=f.getSessionValue("merchantAccount");if(console.log("here is merchant account info",g),"active"===g.response.status)e.resolve(g);else{var h=c.open({templateUrl:"js/submerchant/modals/partials/submerchant.modal.partial.html"});h.result.then(function(a,b){},function(a,b){"subMerchantModalSuccess"===a?(console.log("successful merchant setup.  here is response",b),e.resolve(b)):"abortSubMerchantModal"===a&&console.log("use clicked close button"),d.info("Modal dismissed at: "+new Date)})}return e.promise},g.registerPostForOnlinePayment=function(b){var c=a.defer();return c.promise},g}]),htsApp.directive("transactionButtons",function(){return{restrict:"E",scope:{result:"="},templateUrl:"js/transactionButtons/partials/transactionButtons.partial.html",controller:["$scope","transactionFactory",function(a,b){a.quickCompose=function(){b.quickCompose(a.result)},a.displayPhone=function(){b.displayPhone(a.result)},a.openSplash=function(){b.openSplash(a.result)},a.placeBid=function(){b.placeBid(a.result)},a.placeOffer=function(){b.placeOffer(a.result)}}]}}),htsApp.factory("transactionFactory",["Session","$modal","$log","$state","authModalFactory","quickComposeFactory","splashFactory","$window","$state",function(a,b,c,d,e,f,g,h,d){var i={};return i.quickCompose=function(g){if(console.log("item we clicked on",g),a.userObj.user_settings.loggedIn)if("ask"===a.userObj.user_settings.email_provider[0].value){var h=b.open({templateUrl:"/js/transactionButtons/modals/email/partials/transactionButtons.modal.email.partial.html",controller:"quickComposeController",resolve:{result:function(){return g}}});h.result.then(function(a){},function(a){console.log(a),"signUp"===a&&e.signUpModal(),c.info("Modal dismissed at: "+new Date)})}else f.generateMailTo(a.userObj.user_settings.email_provider[0].value,g);else d.go("signup")},i.displayPhone=function(f){if(a.userObj.user_settings.loggedIn){var g=b.open({templateUrl:"/js/transactionButtons/modals/phone/partials/transactionButtons.modal.phone.partial.html",controller:"phoneModalController",resolve:{result:function(){return f}}});g.result.then(function(a){},function(a){console.log(a),"signUp"===a&&e.signUpModal(),c.info("Modal dismissed at: "+new Date)})}else d.go("signup")},i.openSplash=function(a){g.result=a,d.go("results.splash",{id:a.external.source.url})},i.placeBid=function(b){a.userObj.user_settings.loggedIn?h.open(b.external.source.url):d.go("signup")},i.showOriginal=function(b){a.userObj.user_settings.loggedIn?h.open(b.external.source.url):d.go("signup")},i.placeOffer=function(f){if(a.userObj.user_settings.loggedIn){var g=b.open({templateUrl:"/js/transactionButtons/modals/placeOffer/partials/transactionButtons.modal.placeOffer.partial.html",controller:"placeOfferController",resolve:{result:function(){return f}}});g.result.then(function(a){},function(a){console.log(a),"signUp"===a&&e.signUpModal(),c.info("Modal dismissed at: "+new Date)})}else d.go("signup")},i}]),htsApp.controller("quickComposeController",["$scope","$modalInstance","quickComposeFactory","Session","$window","result",function(a,b,c,d,e,f){a.userObj=d.userObj,a.emailOptionsObject=[{name:"Use Default Mail Client",value:"mailto"},{name:"Gmail",value:"gmail"},{name:"Yahoo",value:"yahoo"},{name:"Hotmail",value:"hotmail"},{name:"AOL",value:"aol"}],a.selected="mailto",a.qcEmail=function(){a.setDefaultEmailProvider&&c.setDefaultEmailProvider(a.selected),c.generateMailTo(a.selected,f),b.dismiss("auto-compose complete")},a.dismiss=function(a){b.dismiss(a)}}]),htsApp.factory("quickComposeFactory",["Session","$window",function(a,b){var c={};return c.generateMailTo=function(a,c){var d="";if(c.length){var e="";for(i=0;i<c.length;i++)c[i].annotations.source_account&&(e+=c[i].annotations.source_account+",");switch(a){case"gmail":d="https://mail.google.com/mail/?view=cm&fs=1&bcc="+e+"&su=I'd like to buy your item...&body=HashtagSell.com - Re-thinking Online Classifieds",b.open(d);break;case"yahoo":d="http://compose.mail.yahoo.com/?bcc="+e+"&subject=I'd like to buy your item...&body=HashtagSell.com - Re-thinking Online Classifieds",b.open(d);break;case"hotmail":d="https://mail.live.com/default.aspx?rru=compose&bcc="+e+"&subject=I'd like to buy your item...&body=HashtagSell.com - Re-thinking Online Classifieds",b.open(d);break;case"aol":d="http://mail.aol.com/mail/compose-message.aspx?bcc="+e+"&subject=I'd like to buy your item...&body=HashtagSell.com - Re-thinking Online Classifieds",b.open(d);break;case"mailto":d="mailto:?bcc="+e+"&subject=I'd like to buy your item...&body=HashtagSell.com - Re-thinking Online Classifieds",b.open(d)}}else switch(a){case"gmail":d="https://mail.google.com/mail/?view=cm&fs=1&to="+c.annotations.source_account+"&su="+c.heading+"&body="+c.external.source.url,b.open(d);break;case"yahoo":d="http://compose.mail.yahoo.com/?to="+c.annotations.source_account+"&subject="+c.heading+"&body="+c.external.source.url,b.open(d);break;case"hotmail":d="https://mail.live.com/default.aspx?rru=compose&to="+c.annotations.source_account+"&subject="+c.heading+"&body="+c.external.source.url,b.open(d);break;case"aol":d="http://mail.aol.com/mail/compose-message.aspx?to="+c.annotations.source_account+"&subject="+c.heading+"&body="+c.external.source.url,b.open(d);break;case"mailto":d="mailto:"+c.annotations.source_account+"?Subject="+c.heading+"&body="+c.external.source.url,b.open(d)}},c.setDefaultEmailProvider=function(b){var c;switch(b){case"ask":c=[{name:"Always Ask",value:"ask"}];break;case"gmail":c=[{name:"Gmail",value:"gmail"}];break;case"yahoo":c=[{name:"Yahoo",value:"yahoo"}];break;case"hotmail":c=[{name:"Hotmail",value:"hotmail"}];break;case"aol":c=[{name:"AOL",value:"aol"}];break;case"mailto":c=[{name:"Use Default Mail Client",value:"mailto"}]}a.setSessionValue("email_provider",c,function(){console.log("default email updated")})},c}]),htsApp.controller("phoneModalController",["$scope","$modalInstance","Session","result",function(a,b,c,d){a.userObj=c.userObj,a.result=d,a.dismiss=function(a){b.dismiss(a)}}]),htsApp.controller("placeOfferController",["$scope","$modalInstance","Session","result","ENV","$filter","meetingsFactory","favesFactory","socketio",function(a,b,c,d,e,f,g,h,i){a.userObj=c.userObj,a.result=d,a.disableSubmission=!0,a.offer={proposedTimes:[],username:a.userObj.user_settings.name},a.onTimeSet=function(b,c){a.dropDownStatus.isOpen=!1,b=f("date")(b,"yyyy-MM-ddTHH:mm:ssZ"),a.addProposedTime(b),a.data.dateDropDownInput=null,console.log(b)},a.dropDownStatus={isOpen:!1},a.dismiss=function(a){b.dismiss(a)},a.addProposedTime=function(b){a.offer.proposedTimes.push({when:b,where:d.external.threeTaps.location.formatted}),a.disableSubmission=a.validateProposal()},a.removeProposedTime=function(b){a.offer.proposedTimes.splice(b,1),a.disableSubmission=a.validateProposal()},a.validateProposal=function(){return a.offer.proposedTimes.length<1},a.sendOffer=function(){i.joinPostingRoom(a.result.postingId,"inWatchList",function(){g.sendOffer(a.result,a.offer).then(function(b){a.dismiss("offer sent")},function(b){a.dismiss("error"),alert(b)})})}}]),htsApp.controller("userMenu",["$scope","Session","authModalFactory","$modal","newPostFactory",function(a,b,c,d,e){a.userObj=b.userObj,a.logout=function(){b.destroy()},a.newPost=function(){var b=d.open({templateUrl:"/js/newPost/modals/newPost/partials/newpost.html",controller:"newPostModal",size:"lg",resolve:{mentionsFactory:function(){return e}}});b.result.then(function(b){a.modalContent.selected=b},function(){console.log("Modal dismissed at: "+new Date)})}}]),htsApp.factory("utilsFactory",["ENV",function(a){var b={};return b.bracketNotationURL=function(a,c,d){d=d||[];var e=0;for(var f in a)if(e++,a.hasOwnProperty(f))if(c||d.length?e>1&&d.length&&-1===c.indexOf("[")?c="&"+f:e>1&&d.length&&-1!==c.indexOf("[")?c=c.replace(/\[(.+?)\]/g,"["+f+"]"):c+="["+f+"]":c="?"+f,"object"==typeof a[f]&&null!==a[f]&&a[f].constructor!==Array)b.bracketNotationURL(a[f],c,d);else{var g=c;g+=a[f].constructor===Array?"="+a[f].join():"="+a[f],d.push(g)}return d.join("")},b}]),htsApp.factory("categoryFactory",["$http","$q","ENV",function(a,b,c){var d={};return d.lookupCategories=function(){var d=b.defer();return a({method:"GET",url:c.groupingsAPI}).then(function(a,b,c,e){console.log("reference api response",a),d.resolve(a)},function(a,b,c,e){d.reject(a)}),d.promise},d}]),htsApp.factory("ebayFactory",["$q","$http","$window","$rootScope","$timeout","$interval","ENV","Session","Notification",function(a,b,c,d,e,f,g,h,i){var j={};j.publishToEbay=function(c){var d=a.defer(),e=h.getSessionValue("ebay"),f={ebay:!0};return c.facebook&&(f.facebook=c.facebook),c.twitter&&(f.twitter=c.twitter),c.amazon&&(f.amazon=c.amazon),c.craigslist&&(f.craigslist=c.craigslist),j.isEmpty(e)?j.getEbaySessionID().then(function(a){h.setSessionValue("ebay",a.data.ebay,function(){b.post(g.postingAPI+c.postingId+"/publish",f).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)})})},function(a){i.error({title:"Manually link eBay account",message:"After completing eBay authorization please click the big red button below.",delay:1e4})}):b.post(g.postingAPI+c.postingId+"/publish",f).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),d.promise},j.getEbaySessionID=function(){var d=a.defer(),e=c.open(g.htsAppUrl+"/ebayauth","","width=1020, height=500");return b({method:"GET",url:g.ebayAuth+"/sessionId"}).then(function(a){var c=a.data.GetSessionIDResponse.SessionID,h=g.ebaySignIn+"?SignIn&RUName="+g.ebayRuName+"&SessID="+c;e.location=h;var i=0,j=f(function(){b({method:"GET",url:g.ebayAuth+"/fetchToken",params:{sessionId:c}}).then(function(a){console.log(a),a.data.success?(e.close(),f.cancel(j),d.resolve(a)):50===i?(f.cancel(j),a.data.sessionId=c,d.reject(a)):(i++,console.log(i))})},2e3)},function(a){d.reject(a)}),d.promise},j.manuallyGetEbayToken=function(c){var d=a.defer();return b({method:"GET",url:g.ebayAuth+"/fetchToken",params:{sessionId:c}}).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d.promise},j.disconnectEbay=function(){h.setSessionValue("ebay",{},function(){console.log("ebay account disconnected!")})};var k=Object.prototype.hasOwnProperty;return j.isEmpty=function(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(k.call(a,b))return!1;

return!0},j}]),htsApp.factory("facebookFactory",["$q","ENV","$http","Session","ezfb",function(a,b,c,d,e){var f={};f.publishToWall=function(g){function h(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText||""}var i=a.defer(),j=d.getSessionValue("facebook");console.log("facebook tokens",j),g.plainTextBody=h(g.body);var k=new Date;if(!f.isEmpty(j)&&j.tokenExpiration>k||!f.isEmpty(j)&&!j.tokenExpiration){var l=null;l=g.images.length?{message:b.htsAppUrl+"/ext/"+g.postingId+" "+g.plainTextBody,picture:g.images[0].full||g.images[0].thumbnail,access_token:j.token}:{message:b.htsAppUrl+"/ext/"+g.postingId+" "+g.plainTextBody,link:b.htsAppUrl+"/ext/"+g.postingId,access_token:j.token},console.log("here is our fb post object: ",l),e.api("/me/feed","post",l,function(a){if(a.error)i.reject(a);else{console.log("here is our facebook success response: ",a);var d={facebook:a};g.twitter&&(d.twitter=g.twitter),g.amazon&&(d.amazon=g.amazon),g.ebay&&(d.ebay=g.ebay),g.craigslist&&(d.craigslist=g.craigslist),c.post(b.postingAPI+g.postingId+"/publish",d).success(function(a){i.resolve(a)}).error(function(a){i.reject(a)})}})}else e.login(function(a){if(console.log("res AuthResponse",a),a.authResponse){var f=new Date;f.setSeconds(a.authResponse.expiresIn);var h={};h.id=a.authResponse.userID,h.token=a.authResponse.accessToken,h.tokenExpiration=f,e.api("/me",function(a){console.log("apiMe",a),h.email=a.email,h.name=a.first_name+" "+a.last_name,console.log(h),d.setSessionValue("facebook",h,function(){var a=null;a=g.images.length?{message:g.plainTextBody,picture:g.images[0].full||g.images[0].thumbnail,link:b.htsAppUrl+"/ext/"+g.postingId,access_token:h.token}:{message:g.plainTextBody,link:b.htsAppUrl+"/ext/"+g.postingId,access_token:h.token},e.api("/me/feed","post",a,function(a){if(a.error)i.reject(a);else{var d={facebook:a};g.twitter&&(d.twitter=g.twitter),g.amazon&&(d.amazon=g.amazon),g.ebay&&(d.ebay=g.ebay),g.craigslist&&(d.craigslist=g.craigslist),c.post(b.postingAPI+g.postingId+"/publish",d).success(function(a){i.resolve(a)}).error(function(a){i.reject(a)})}})})})}else i.reject({error:{message:"Could not login to Facebook Account"}})},{scope:"email, publish_actions"});return i.promise},f.disconnectFacebook=function(){d.setSessionValue("facebook",{},function(){console.log("facebook account disconnected!")})};var g=Object.prototype.hasOwnProperty;return f.isEmpty=function(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(g.call(a,b))return!1;return!0},f}]),htsApp.factory("twitterFactory",["$q","$http","$window","$interval","ENV","Session",function(a,b,c,d,e,f){var g={};g.publishToTwitter=function(h){function i(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText||""}var j=a.defer(),k=f.getSessionValue("twitter");if(h.plainTextBody=i(h.body),g.isEmpty(k))var l=c.open(e.htsAppUrl+"/auth/twitter","","width=1020, height=500"),m=0,n=d(function(){f.getUserFromServer().then(function(a){console.log(a),a.user_settings.linkedAccounts.twitter.token?(d.cancel(n),l.close(),f.create(a),b({method:"POST",url:e.htsAppUrl+"/publishTweet",data:{posting:h,token:a.user_settings.linkedAccounts.twitter.token,tokenSecret:a.user_settings.linkedAccounts.twitter.tokenSecret}}).then(function(a){var c={twitter:{id:a.data.id}};h.facebook&&(c.facebook=h.facebook),h.amazon&&(c.amazon=h.amazon),h.ebay&&(c.ebay=h.ebay),h.craigslist&&(c.craigslist=h.craigslist),b.post(e.postingAPI+h.postingId+"/publish",c).success(function(a){j.resolve(a)}).error(function(a){j.reject(a)})},function(a){j.reject(a)})):50===m?(d.cancel(n),j.reject(a)):(m++,console.log(m))})},2e3);else b({method:"POST",url:e.htsAppUrl+"/publishTweet",data:{posting:h,token:k.token,tokenSecret:k.tokenSecret}}).then(function(a){var c={twitter:{id:a.data.id}};h.facebook&&(c.facebook=h.facebook),h.amazon&&(c.amazon=h.amazon),h.ebay&&(c.ebay=h.ebay),h.craigslist&&(c.craigslist=h.craigslist),b.post(e.postingAPI+h.postingId+"/publish",c).success(function(a){j.resolve(a)}).error(function(a){j.reject(a)})},function(a){j.reject(a)});return j.promise},g.disconnectTwitter=function(){f.setSessionValue("twitter",{},function(){console.log("twitter account disconnected!")})};var h=Object.prototype.hasOwnProperty;return g.isEmpty=function(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(h.call(a,b))return!1;return!0},g}]),htsApp.controller("watchlistController",["$scope","$rootScope","favesFactory","splashFactory","$state","ngTableParams","$filter","Session","quickComposeFactory","$modal","$log",function(a,b,c,d,e,f,g,h,j,k,l){a.currentFaves=h.userObj.user_settings.favorites,c.tableParams=new f({page:1,count:2e3,filter:{},sorting:{}},{counts:[],total:a.currentFaves.length,getData:function(b,d){var e=g("filter")(a.currentFaves,c.filterString),f=d.sorting()?g("orderBy")(e,d.orderBy()):e;d.total(f.length),b.resolve(f.slice((d.page()-1)*d.count(),d.page()*d.count()))}}),a.tableParams=c.tableParams,a.tableParams.settings().$scope=a,a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.currentState=c.name,a.expandedPostingId=d.postingId}),a.removeFave=function(a){c.removeFave(a,function(){c.refreshTable()})},a.checkboxes={checked:!1,items:{}},a.$watch("checkboxes.items",function(b){if(a.currentFaves){var c=0,d=0;totalFaves=a.currentFaves.length,angular.forEach(a.currentFaves,function(b){c+=a.checkboxes.items[b.postingId]||0,d+=!a.checkboxes.items[b.postingId]||0}),console.log("checked: ",c,"unchecked: ",d),(0===d&&0!==totalFaves||0===c&&0!==totalFaves)&&(a.checkboxes.masterCheck=c==totalFaves),0===c||0===totalFaves?a.checkboxes.checked=!1:a.checkboxes.checked=!0,angular.element(document.getElementById("select_all")).prop("indeterminate",0!==c&&0!==d)}},!0),a.$watch("checkboxes.masterCheck",function(b){angular.forEach(a.currentFaves,function(c){angular.isDefined(c.postingId)&&(a.checkboxes.items[c.postingId]=b)})}),a.filters={$:""},a.$watch("filters.$",function(b){c.filterString=b,console.log(c.filterString),a.tableParams.reload()}),a.batchRemoveFaves=function(b){c.batchRemoveFaves(b),a.checkboxes={checked:!1,items:{}}},a.batchEmail=function(b){var c=a.currentFaves,d=[];if(angular.forEach(b.items,function(a,b){if(a)for(console.log("this item selected",a,b),i=0;i<c.length;i++)c[i].postingId==b&&d.push(c[i])}),console.log(d),"ask"===h.userObj.user_settings.email_provider[0].value){var e=k.open({templateUrl:"/js/transactionButtons/modals/email/partials/transactionButtons.modal.email.partial.html",controller:"quickComposeController",resolve:{result:function(){return d}}});e.result.then(function(a){},function(a){console.log(a),"signUp"===a&&authModalFactory.signUpModal(),l.info("Modal dismissed at: "+new Date)})}else j.generateMailTo(h.userObj.user_settings.email_provider[0].value,d)},a.UserLabels=c.getUserLabels(),a.selected_labels=[],a.preselected={name:[]},a.openSplash=function(a){d.result=a,console.log(d.result),e.go("watchlist.splash",{id:a.postingId})},a.expandCollapseQuestions=function(a,c){a.stopPropagation(),"watchlist.questions"!==b.currentState?(c.currentlyViewing={questions:!0,meetings:!1},e.go("watchlist.questions",{postingId:c.postingId})):(c.currentlyViewing={questions:!1,meetings:!1},e.go(b.previousState))},a.expandCollapseMeetingRequests=function(a,c){a.stopPropagation(),"watchlist.meetings"!==b.currentState?(c.currentlyViewing={questions:!1,meetings:!0},e.go("watchlist.meetings",{postingId:c.postingId})):(c.currentlyViewing={questions:!1,meetings:!1},e.go(b.previousState))}}]),htsApp.factory("favesFactory",["Session","myPostsFactory",function(a,b){var c={};return c.currentFavorites=a.userObj.user_settings.favorites,c.addFave=function(c,d){var e=_.some(a.userObj.user_settings.favorites,function(a){return a.postingId===c.postingId});e||("HSHTG"===c.external.source.code?b.getPostingIdQuestionsAndOffers(c.postingId).then(function(b){var c=b.data;a.userObj.user_settings.favorites.push(c),a.setSessionValue("favorites",a.userObj.user_settings.favorites,d)}):(a.userObj.user_settings.favorites.push(c),a.setSessionValue("favorites",a.userObj.user_settings.favorites,d)))},c.removeFave=function(b,c){var d=a.userObj.user_settings.favorites,e=[];_.some(d,function(a){a.postingId==b.postingId&&e.push(d.indexOf(a))}),e.length>0&&(d.splice(e[0],1),a.setSessionValue("favorites",d,c))},c.updateFavorite=function(d,e){var f=a.userObj.user_settings.favorites;console.log("emitted favorite object",d),console.log("currentFavorites",f);for(var g,h=0;h<f.length;h++){var i=f[h];if(console.log(i.postingId,d.posting.postingId),i.postingId===d.posting.postingId){g=h;break}}console.log("done with loop"),g>=0&&(console.log("here is matching favorite"),console.log(f[g]),b.getPostingIdQuestionsAndOffers(d.posting.postingId).then(function(b){var d=b.data;a.userObj.user_settings.favorites[g]=d;try{c.refreshTable()}catch(f){console.log(f)}finally{a.setSessionValue("favorites",a.userObj.user_settings.favorites,e)}}))},c.checkFave=function(b,c){var d=a.userObj.user_settings.favorites,e=[];_.some(d,function(a){a.postingId==b.postingId&&e.push(d.indexOf(a))}),c(e.length>0?!0:!1)},c.refreshTable=function(){console.log("refreshing favorites table"),c.tableParams.reload()},c.filterString="",c.batchRemoveFaves=function(a){console.log(a),angular.forEach(a.items,function(a,b){if(console.log("checked: ",a,"id: ",b),a){var d={};d.postingId=b,c.removeFave(d,function(){c.refreshTable()})}})},c.addFavoriteLabel=function(b){var c=a.userObj;c.user_settings.user_labels||(c.user_settings.user_labels=[]),c.user_settings.user_labels.push(b),a.setSessionValue("user_labels",c.user_settings.user_labels)},c.removeFavoriteLabel=function(b,c){var d=a.userObj;d.user_settings.user_labels=_.without(d.user_settings.user_labels,_.findWhere(d.user_settings.user_labels,b)),a.setSessionValue("user_labels",d.user_settings.user_labels);var e=[];_.each(d.user_settings.favorites,function(a){a.labels=_.without(a.labels,_.findWhere(a.labels,b.name)),e.push(a)}),d.user_settings.favorites=e,a.setSessionValue("favorites",d.user_settings.favorites,c)},c.getUserLabels=function(){return a.getSessionValue("user_labels")},c}]),htsApp.controller("watchlist.meetings.controller",["$scope","Session","meetingsFactory","Notification","favesFactory",function(a,b,c,d,e){a.userObj=b.userObj,a.toggled=function(a){console.log("Dropdown is now: ",a)},a.cancelOffer=function(a){var b=a.postingId,e=a.offerId;c.deleteOffer(b,e).then(function(a){console.log(a),204===a.status||d.error({title:a.name,message:a.message,delay:2e4})},function(a){console.log(a),d.error({title:a.data.name,message:a.data.message,delay:2e4})})}}]),htsApp.directive("senderMeetingsMoreInfo",function(){return{restrict:"E",scope:{post:"="},templateUrl:"js/watchlist/meetings/partials/watchlist.meetings.html",controller:"watchlist.meetings.controller"}}),htsApp.controller("watchlist.questions.controller",["$scope","qaFactory","$state","Notification","myPostsFactory","Session",function(a,b,c,d,e,f){console.log("watchlist.questions.controller"),a.userObj=f.userObj,a.showAnswered=!1,a.toggled=function(a){console.log("Dropdown is now: ",a)},a.deleteQuestion=function(a,c){console.log(a,c),b.deleteQuestion(a,c).then(function(a){204===a.status||d.error({title:a.name,message:a.message})},function(a){})}}]),htsApp.directive("senderQuestionsMoreInfo",function(){return{restrict:"E",scope:{post:"="},templateUrl:"js/watchlist/questions/partials/watchlist.questions.html",controller:"watchlist.questions.controller"}}),htsApp.factory("watchlistQuestionsFactory",["$http","$rootScope","ENV","$q","utilsFactory",function(a,b,c,d,e){var f={};return f.questions={store:[]},f.getPostingIdQuestions=function(b){var g=d.defer(),h={postingId:b,questions:!0,count:100};return a({method:"GET",url:c.postingAPI+b+e.bracketNotationURL(h)}).then(function(a,b,c,d){200===a.status?(f.questions.store=a.data.questions.results,g.resolve(a)):g.reject(a)},function(a,b,c,d){g.reject(a)}),g.promise},f.submitQuestion=function(b,e,g){var h=d.defer(),i=e.postingId,j={username:g,value:b};return a({method:"POST",url:c.postingAPI+i+"/questions",data:j}).then(function(a,b,c,d){f.getPostingIdQuestions(i).then(function(a){h.resolve(a)},function(a){h.reject(a)})},function(a,b,c,d){h.reject(a)}),h.promise},f.deleteQuestion=function(b,e){var g=d.defer();return a({method:"DELETE",url:c.postingAPI+b+"/questions/"+e}).then(function(a,c,d,e){f.getPostingIdQuestions(b).then(function(a){g.resolve(a)},function(a){g.reject(a)})},function(a,b,c,d){g.reject(a)}),g.promise},f.deleteAnswer=function(b,e,g){var h=d.defer();return a({method:"DELETE",url:c.postingAPI+b+"/questions/"+e+"/answers/ "+g}).then(function(a,c,d,e){f.getPostingIdQuestions(b).then(function(a){h.resolve(a)},function(a){h.reject(a)})},function(a,b,c,d){h.reject(a)}),h.promise},f}]);